<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" type="image/x-icon" sizes="128x128" href="/favicon.ico"><title>K8s | Vbeats</title><meta name="description" content="Good Good Study ğŸ‘ Day Day UP">
    <link rel="preload" href="/assets/js/runtime~app.6686f77d.js" as="script"><link rel="preload" href="/assets/css/styles.c3e81397.css" as="style"><link rel="preload" href="/assets/js/7.3d9f59d0.js" as="script"><link rel="preload" href="/assets/js/app.42261b4c.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.c3e81397.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Vbeats</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/base/" class="nav-link" aria-label="æ‚è®°"><!--[--><!--]--> æ‚è®° <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/backend/" class="nav-link" aria-label="åç«¯"><!--[--><!--]--> åç«¯ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/frontend/" class="nav-link" aria-label="å‰ç«¯ğŸ‘½"><!--[--><!--]--> å‰ç«¯ğŸ‘½ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/cloud/" class="nav-link router-link-active" aria-label="äº‘â˜ï¸"><!--[--><!--]--> äº‘â˜ï¸ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/arch/" class="nav-link" aria-label="æ¶æ„ğŸ¥"><!--[--><!--]--> æ¶æ„ğŸ¥ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/data/" class="nav-link" aria-label="æ•°æ®å¤„ç†"><!--[--><!--]--> æ•°æ®å¤„ç† <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/datav/" class="nav-link" aria-label="æ•°æ®å¯è§†åŒ–"><!--[--><!--]--> æ•°æ®å¯è§†åŒ– <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="é…ç½®"><!--[--><!--]--> é…ç½® <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/" class="nav-link" aria-label="å…¶å®ƒèµ„æº"><!--[--><!--]--> å…¶å®ƒèµ„æº <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/boot-vue" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="æŒ‰ä¸‹ / æœç´¢" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/base/" class="nav-link" aria-label="æ‚è®°"><!--[--><!--]--> æ‚è®° <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/backend/" class="nav-link" aria-label="åç«¯"><!--[--><!--]--> åç«¯ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/frontend/" class="nav-link" aria-label="å‰ç«¯ğŸ‘½"><!--[--><!--]--> å‰ç«¯ğŸ‘½ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/cloud/" class="nav-link router-link-active" aria-label="äº‘â˜ï¸"><!--[--><!--]--> äº‘â˜ï¸ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/arch/" class="nav-link" aria-label="æ¶æ„ğŸ¥"><!--[--><!--]--> æ¶æ„ğŸ¥ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/data/" class="nav-link" aria-label="æ•°æ®å¤„ç†"><!--[--><!--]--> æ•°æ®å¤„ç† <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/datav/" class="nav-link" aria-label="æ•°æ®å¯è§†åŒ–"><!--[--><!--]--> æ•°æ®å¯è§†åŒ– <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="å…¶å®ƒ"><span class="title">å…¶å®ƒ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="é…ç½®"><!--[--><!--]--> é…ç½® <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/" class="nav-link" aria-label="å…¶å®ƒèµ„æº"><!--[--><!--]--> å…¶å®ƒèµ„æº <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/boot-vue" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">åŸºç¡€</p><ul class=""><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="K8s"><!--[--><!--]--> K8s <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#kubeadm-å¼•å¯¼é›†ç¾¤" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="kubeadm å¼•å¯¼é›†ç¾¤"><!--[--><!--]--> kubeadm å¼•å¯¼é›†ç¾¤ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#åˆå§‹åŒ–é›†ç¾¤" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="åˆå§‹åŒ–é›†ç¾¤"><!--[--><!--]--> åˆå§‹åŒ–é›†ç¾¤ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#dashboard" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="dashboard"><!--[--><!--]--> dashboard <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#é«˜å¯ç”¨é›†ç¾¤" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="é«˜å¯ç”¨é›†ç¾¤"><!--[--><!--]--> é«˜å¯ç”¨é›†ç¾¤ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#kubectl" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="kubectl"><!--[--><!--]--> kubectl <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#pod" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="pod"><!--[--><!--]--> pod <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#ç”Ÿå‘½å‘¨æœŸ" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç”Ÿå‘½å‘¨æœŸ"><!--[--><!--]--> ç”Ÿå‘½å‘¨æœŸ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#çŠ¶æ€æ£€æµ‹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="çŠ¶æ€æ£€æµ‹"><!--[--><!--]--> çŠ¶æ€æ£€æµ‹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#ç±»å‹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ç±»å‹"><!--[--><!--]--> ç±»å‹ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#æœåŠ¡å‘ç°" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æœåŠ¡å‘ç°"><!--[--><!--]--> æœåŠ¡å‘ç° <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#port" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="port"><!--[--><!--]--> port <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#headless-service" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="headless service"><!--[--><!--]--> headless service <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#externalname" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ExternalName"><!--[--><!--]--> ExternalName <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#ingress-è´Ÿè½½å‡è¡¡å™¨" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ingress è´Ÿè½½å‡è¡¡å™¨"><!--[--><!--]--> ingress è´Ÿè½½å‡è¡¡å™¨ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#å­˜å‚¨" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å­˜å‚¨"><!--[--><!--]--> å­˜å‚¨ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#config-map" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="config map"><!--[--><!--]--> config map <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#secret" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="secret"><!--[--><!--]--> secret <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#volume" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="volume"><!--[--><!--]--> volume <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#pv-pvc" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="pv/pvc"><!--[--><!--]--> pv/pvc <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#å·¥ä½œè´Ÿè½½" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å·¥ä½œè´Ÿè½½"><!--[--><!--]--> å·¥ä½œè´Ÿè½½ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#replication-controllers" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Replication Controllers"><!--[--><!--]--> Replication Controllers <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#replica-sets" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Replica Sets"><!--[--><!--]--> Replica Sets <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#deployment" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Deployment"><!--[--><!--]--> Deployment <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#daemon-sets" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Daemon Sets"><!--[--><!--]--> Daemon Sets <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#stateful-sets" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Stateful Sets"><!--[--><!--]--> Stateful Sets <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#cron-jobs" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Cron Jobs"><!--[--><!--]--> Cron Jobs <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#jobs" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Jobs"><!--[--><!--]--> Jobs <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#hpa" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="hpa"><!--[--><!--]--> hpa <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#è°ƒåº¦å™¨" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è°ƒåº¦å™¨"><!--[--><!--]--> è°ƒåº¦å™¨ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#è°ƒåº¦è¿‡ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è°ƒåº¦è¿‡ç¨‹"><!--[--><!--]--> è°ƒåº¦è¿‡ç¨‹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#affinity" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="affinity"><!--[--><!--]--> affinity <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#taint-toleration" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="taint/toleration"><!--[--><!--]--> taint/toleration <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#æŒ‡å®šèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æŒ‡å®šèŠ‚ç‚¹"><!--[--><!--]--> æŒ‡å®šèŠ‚ç‚¹ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#å®‰å…¨æ§åˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å®‰å…¨æ§åˆ¶"><!--[--><!--]--> å®‰å…¨æ§åˆ¶ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#rbac" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="rbac"><!--[--><!--]--> rbac <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#yaml-é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="yaml é…ç½®"><!--[--><!--]--> yaml é…ç½® <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#version" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="version"><!--[--><!--]--> version <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#kind" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="kind"><!--[--><!--]--> kind <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#metadata" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="metadata"><!--[--><!--]--> metadata <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#spec" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="spec"><!--[--><!--]--> spec <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#helm" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Helm"><!--[--><!--]--> Helm <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#chart" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="chart"><!--[--><!--]--> chart <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#release" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="release"><!--[--><!--]--> release <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#è‡ªå®šä¹‰-chart" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="è‡ªå®šä¹‰ chart"><!--[--><!--]--> è‡ªå®šä¹‰ chart <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cloud/base/k8s.html#values" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Values"><!--[--><!--]--> Values <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/cloud/base/rancher.html" class="nav-link sidebar-item" aria-label="Rancher ğŸ„"><!--[--><!--]--> Rancher ğŸ„ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/cloud/base/kong.html" class="nav-link sidebar-item" aria-label="Kong"><!--[--><!--]--> Kong <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">æ–‡ç« </p><ul class=""><li><!--[--><a href="/cloud/article/.md" class="nav-link sidebar-item" aria-label="/cloud/article/.md"><!--[--><!--]--> /cloud/article/.md <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="k8s" tabindex="-1"><a class="header-anchor" href="#k8s" aria-hidden="true">#</a> K8s</h1><ul><li>èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªè¿è¡Œ Kubernetes ä¸­çš„ä¸»æœºã€‚</li><li>å®¹å™¨ç»„ï¼ˆPodï¼‰ï¼šä¸€ä¸ª Pod å¯¹åº”äºç”±è‹¥å¹²å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®¹å™¨ç»„ï¼ŒåŒä¸ªç»„å†…çš„å®¹å™¨å…±äº«ä¸€ä¸ªå­˜å‚¨å·(volume)ã€‚</li><li>å®¹å™¨ç»„ç”Ÿå‘½å‘¨æœŸï¼ˆpos-statesï¼‰ï¼šåŒ…å«æ‰€æœ‰å®¹å™¨çŠ¶æ€é›†åˆï¼ŒåŒ…æ‹¬å®¹å™¨ç»„çŠ¶æ€ç±»å‹ï¼Œå®¹å™¨ç»„ç”Ÿå‘½å‘¨æœŸï¼Œäº‹ä»¶ï¼Œé‡å¯ç­–ç•¥ï¼Œä»¥åŠ replication controllersã€‚</li><li>Replication Controllersï¼šä¸»è¦è´Ÿè´£æŒ‡å®šæ•°é‡çš„ pod åœ¨åŒä¸€æ—¶é—´ä¸€èµ·è¿è¡Œ åºŸå¼ƒ</li><li>æœåŠ¡ï¼ˆservicesï¼‰ï¼šä¸€ä¸ª Kubernetes æœåŠ¡æ˜¯å®¹å™¨ç»„é€»è¾‘çš„é«˜çº§æŠ½è±¡ï¼ŒåŒæ—¶ä¹Ÿå¯¹å¤–æä¾›è®¿é—®å®¹å™¨ç»„çš„ç­–ç•¥ã€‚</li><li>å·ï¼ˆvolumesï¼‰ï¼šä¸€ä¸ªå·å°±æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®¹å™¨å¯¹å…¶æœ‰è®¿é—®æƒé™ã€‚</li><li>æ ‡ç­¾ï¼ˆlabelsï¼‰ï¼šæ ‡ç­¾æ˜¯ç”¨æ¥è¿æ¥ä¸€ç»„å¯¹è±¡çš„ï¼Œæ¯”å¦‚å®¹å™¨ç»„ã€‚æ ‡ç­¾å¯ä»¥è¢«ç”¨æ¥ç»„ç»‡å’Œé€‰æ‹©å­å¯¹è±¡ã€‚</li><li>æ¥å£æƒé™ï¼ˆaccessing_the_apiï¼‰ï¼šç«¯å£ï¼ŒIP åœ°å€å’Œä»£ç†çš„é˜²ç«å¢™è§„åˆ™ã€‚</li><li>web ç•Œé¢ï¼ˆuxï¼‰ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ web ç•Œé¢æ“ä½œ Kubernetesã€‚</li><li>å‘½ä»¤è¡Œæ“ä½œï¼ˆcliï¼‰ï¼škubectl å‘½ä»¤ã€‚</li></ul><h2 id="kubeadm-å¼•å¯¼é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#kubeadm-å¼•å¯¼é›†ç¾¤" aria-hidden="true">#</a> kubeadm å¼•å¯¼é›†ç¾¤</h2><blockquote><p>image registry: <code>registry.aliyuncs.com/google_containers</code></p></blockquote><blockquote><p>1master 2 node</p></blockquote><table><thead><tr><th>Node</th><th>role</th></tr></thead><tbody><tr><td>192.168.100.80</td><td>control-plane,master</td></tr><tr><td>192.168.100.81</td><td>worker</td></tr><tr><td>192.168.100.82</td><td>worker</td></tr></tbody></table><h2 id="åˆå§‹åŒ–é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–é›†ç¾¤" aria-hidden="true">#</a> åˆå§‹åŒ–é›†ç¾¤</h2><ol><li>å®‰è£…<code>kubeadm</code> <code>kubelet</code> <code>kubectl</code> , <code>kubelet</code>è®¾ä¸ºè‡ªå¯åŠ¨</li><li><code>kubeadm</code> åˆå§‹åŒ–<code>control-plane</code> <code>etcd</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubeadm config print init-defaults <span class="token operator">&gt;</span> k8s.yaml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">bootstrapTokens</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> system<span class="token punctuation">:</span>bootstrappers<span class="token punctuation">:</span>kubeadm<span class="token punctuation">:</span>default<span class="token punctuation">-</span>node<span class="token punctuation">-</span>token
    <span class="token key atrule">token</span><span class="token punctuation">:</span> abcdef.0123456789abcdef
    <span class="token key atrule">ttl</span><span class="token punctuation">:</span> 24h0m0s
    <span class="token key atrule">usages</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> signing
      <span class="token punctuation">-</span> authentication
<span class="token key atrule">kind</span><span class="token punctuation">:</span> InitConfiguration
<span class="token key atrule">localAPIEndpoint</span><span class="token punctuation">:</span>
  <span class="token key atrule">advertiseAddress</span><span class="token punctuation">:</span> 192.168.100.80
  <span class="token key atrule">bindPort</span><span class="token punctuation">:</span> <span class="token number">6443</span>
<span class="token key atrule">nodeRegistration</span><span class="token punctuation">:</span>
  <span class="token key atrule">criSocket</span><span class="token punctuation">:</span> /var/run/dockershim.sock
  <span class="token key atrule">name</span><span class="token punctuation">:</span> master
  <span class="token key atrule">taints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
<span class="token punctuation">---</span>
<span class="token key atrule">apiServer</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeoutForControlPlane</span><span class="token punctuation">:</span> 4m0s
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">certificatesDir</span><span class="token punctuation">:</span> /etc/kubernetes/pki
<span class="token key atrule">clusterName</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">controllerManager</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">dns</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> CoreDNS
<span class="token key atrule">etcd</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataDir</span><span class="token punctuation">:</span> /var/lib/etcd
<span class="token key atrule">imageRepository</span><span class="token punctuation">:</span> k8s.gcr.io
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration
<span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> v1.20.0
<span class="token key atrule">networking</span><span class="token punctuation">:</span>
  <span class="token key atrule">dnsDomain</span><span class="token punctuation">:</span> cluster.local
  <span class="token key atrule">serviceSubnet</span><span class="token punctuation">:</span> 10.96.0.0/12
  <span class="token key atrule">podSubnet</span><span class="token punctuation">:</span> 10.244.0.0/16
<span class="token key atrule">scheduler</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><ol start="3"><li>ä¸‹è½½å¿…è¦çš„ç»„ä»¶</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubeadm config images list --config ./k8s.yaml


<span class="token comment"># k8s.gcr.io/kube-apiserver:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-controller-manager:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-scheduler:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-proxy:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/pause:3.2</span>
<span class="token comment"># k8s.gcr.io/etcd:3.4.13-0</span>
<span class="token comment"># k8s.gcr.io/coredns:1.7.0</span>


kubeadm config images pull --config ./k8s.yaml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li>åˆå§‹åŒ–<code>control-plane</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubeadm init --config ./k8s.yaml

<span class="token comment">#  å…¶ä»–èŠ‚ç‚¹æœ€ååŠ å…¥</span>
<span class="token function">sudo</span> kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.100.80:6443 --token abcdef.0123456789abcdef <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:8a8e18afb8aaa05d35305bd7d65e50542d5673032fcb0988089a298fe330cea3

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="5"><li>ç¯å¢ƒå˜é‡</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># é root ç”¨æˆ·ä½¿ `kubectl` å‘½ä»¤   admin.confä»control-planeèŠ‚ç‚¹åŒæ­¥åˆ°å…¶å®ƒworkerèŠ‚ç‚¹</span>
  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

<span class="token comment"># rootç”¨æˆ·</span>

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="6"><li>é›†ç¾¤ pod ç½‘å…³é€šä¿¡ç»„ä»¶</li></ol><blockquote><p>ç¬¬ä¸‰æ–¹æœ‰å¤šç§å®ç°</p></blockquote><p><a href="https://github.com/coreos/flannel" target="_blank" rel="noopener noreferrer">flannel<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># é›†ç¾¤ä¸»èŠ‚ç‚¹æ‰§è¡Œå³å¯</span>
kubectl apply -f flannel.yaml  <span class="token comment"># é•œåƒéœ€è¦æ‹‰å–</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="dashboard" tabindex="-1"><a class="header-anchor" href="#dashboard" aria-hidden="true">#</a> dashboard</h2><p><a href="https://github.com/kubernetes/dashboard/" target="_blank" rel="noopener noreferrer">dashboard<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># portéœ€è¦å¼€æ”¾</span>
kubectl edit services kubernetes-dashboard -n kubernetes-dashboard

<span class="token comment"># type: NodePort</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="é«˜å¯ç”¨é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#é«˜å¯ç”¨é›†ç¾¤" aria-hidden="true">#</a> é«˜å¯ç”¨é›†ç¾¤</h2><p>ä¸Šäº‘å§</p><h2 id="kubectl" tabindex="-1"><a class="header-anchor" href="#kubectl" aria-hidden="true">#</a> kubectl</h2><p><code>kubectl create/apply -f xxx.yaml --record</code> create ä¸ apply : apply æ›´æ–° create æ–°å»º,å·²å­˜åœ¨æŠ¥é”™ record è®°å½•æ¯æ¬¡å˜åŒ–</p><p><code>kubectl get pods -o wide -n xkube-system</code> : namespace</p><p><code>kubectl logs podName -c containerName -n kube-system</code>: æŸ¥çœ‹æŸä¸ª pod æ—¥å¿—</p><p><code>kubectl describe pod xxxx -n kube-system</code>:æŸ¥çœ‹ pod è¯¦ç»†ä¿¡æ¯</p><p><code>kubectl get/delete namespace/namespaces/ns/services/svc/deploy/secrets/pods -n xxxx -o yaml/wide</code> : services:svc deployment: deploy ns:namespace</p><p><code>kubectl scale deployment/deployName --replicas=3</code> : ä¼¸ç¼©</p><p><code>kubectl set image deployment/deployName xxx/vvv:latest</code>:æ›´æ–° deploy é•œåƒ</p><p><code>kubectl rollout undo deployment/deployName --to-revesion=2</code>:å›æ»šåˆ°æŸæ¬¡çš„çŠ¶æ€ é»˜è®¤ä¸Šä¸€æ¬¡</p><p><code>kubectl rollout status deployment/deployName</code>:æŸ¥çœ‹å›æ»šçŠ¶æ€</p><p><code>kubectl rollout history deployment/deployName</code>:æŸ¥çœ‹éƒ¨ç½²å†å²</p><p><code>kubectl explain spec.xx</code> : æŸ¥çœ‹ yaml é…ç½®æ¨¡æ¿</p><p><code>kubectl exit pod/svc xxx</code>: ç¼–è¾‘èµ„æº yaml, ä¿®æ”¹æŸäº›å­—æ®µå¯èƒ½æ— æ•ˆ</p><p><code>kubectl exec podName -c containerName -it -- /bin/bash</code> :è¿›å…¥ pod å®¹å™¨å†…</p><p><code>kubectl label pod xxx k=v --override=true</code>: ä¿®æ”¹æŸä¸ªèµ„æºçš„ label</p><p><code>kubectl expose deployment xxxx --port=80 --target-port=80</code></p><ul><li>svc ç»‘å®šç«¯å£ port/å¯¹å¤–æš´éœ²ç«¯å£ target-port/å®¹å™¨å†…ç«¯å£ é»˜è®¤ä¸€è‡´ node-port/å¤–éƒ¨å¯ä»¥è®¿é—®çš„ç«¯å£</li><li>é»˜è®¤ type: ClusterIP é›†ç¾¤å†…è®¿é—® NodePort:å¤–éƒ¨å¯ä»¥è®¿é—®</li></ul><p><code>kubectl create configmap xxx --from-file=/xxxx</code> :configmap</p><p><code>kubectl get cm/confgmap</code></p><p><code>kubectl taint ndoes xxx k=v:effect</code>: è®¾ç½®æ±¡ç‚¹</p><h2 id="pod" tabindex="-1"><a class="header-anchor" href="#pod" aria-hidden="true">#</a> pod</h2><h3 id="ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> ç”Ÿå‘½å‘¨æœŸ</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pauseå¯åŠ¨<span class="token punctuation">(</span>å®Œæˆç½‘ç»œä¸volumeåˆå§‹åŒ–<span class="token punctuation">)</span>
initåˆå§‹åŒ–<span class="token punctuation">(</span>ä¾æ¬¡,ä¸Šä¸€ä¸ªæˆåŠŸæ‰å¼€å§‹ä¸‹ä¸€ä¸ª<span class="token punctuation">)</span>  start<span class="token punctuation">(</span>postStart<span class="token punctuation">)</span>  run  stop<span class="token punctuation">(</span>preStop<span class="token punctuation">)</span>   readines:å°±ç»ªæ£€æµ‹ liveness: å­˜æ´»æ£€æµ‹

initåˆå§‹åŒ–å¤±è´¥,ä¼šæŒ‰ç…§å®¹å™¨é‡å¯ç­–ç•¥é‡å¯

æ­£åœ¨åˆå§‹åŒ–çš„çŠ¶æ€ä¸ºpending

initContainers nameä¸èƒ½é‡å¤
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>pod
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo The app is running! &amp;&amp; sleep 3600&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>myservice
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;until nslookup myservice; do echo waiting for myservice; sleep 2; done;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>mydb
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;until nslookup mydb; do echo waiting for mydb; sleep 2; done;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="çŠ¶æ€æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#çŠ¶æ€æ£€æµ‹" aria-hidden="true">#</a> çŠ¶æ€æ£€æµ‹</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> readiness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> readiness<span class="token punctuation">-</span>http
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> readiness<span class="token punctuation">-</span>http
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
        <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /health
          <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>http
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>http
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
        <span class="token key atrule">postStart</span><span class="token punctuation">:</span>
          <span class="token key atrule">exec</span><span class="token punctuation">:</span>
            <span class="token key atrule">command</span><span class="token punctuation">:</span>
              <span class="token punctuation">[</span>
                <span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;echo liveness-http test &gt; /usr/share/nginx/html/health&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span>
      <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
        <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /health
          <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="ç±»å‹" tabindex="-1"><a class="header-anchor" href="#ç±»å‹" aria-hidden="true">#</a> ç±»å‹</h3><p><code>è‡ªä¸»pod</code>:é€€å‡ºäº†å°±æ‹‰å€’ <code>æ§åˆ¶å™¨ç®¡ç†çš„pod</code>:æŒ‰æ§åˆ¶å™¨ç­–ç•¥åˆ›å»º</p><h2 id="æœåŠ¡å‘ç°" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å‘ç°" aria-hidden="true">#</a> æœåŠ¡å‘ç°</h2><p>pod èµ„æºçš„æŠ½è±¡ label-selector å¯¹ pod é€»è¾‘åˆ†ç»„</p><h3 id="port" tabindex="-1"><a class="header-anchor" href="#port" aria-hidden="true">#</a> port</h3><ul><li>ClusterPort é›†ç¾¤å†…</li><li>NodePort æ¯ä¸ª node èŠ‚ç‚¹éƒ½ç»‘å®šç«¯å£å¯¹å¤–æœåŠ¡</li><li>LoadBalancer</li><li>ExternalName é›†ç¾¤å¤–éƒ¨æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨æ¥</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> MyApp
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9376</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="headless-service" tabindex="-1"><a class="header-anchor" href="#headless-service" aria-hidden="true">#</a> headless service</h3><p>æœ‰çŠ¶æ€æœåŠ¡ä½¿ç”¨</p><h3 id="externalname" tabindex="-1"><a class="header-anchor" href="#externalname" aria-hidden="true">#</a> ExternalName</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> prod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ExternalName
  <span class="token key atrule">externalName</span><span class="token punctuation">:</span> my.database.example.com
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="ingress-è´Ÿè½½å‡è¡¡å™¨" tabindex="-1"><a class="header-anchor" href="#ingress-è´Ÿè½½å‡è¡¡å™¨" aria-hidden="true">#</a> ingress è´Ÿè½½å‡è¡¡å™¨</h2><p><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">nginx-ingress<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><h2 id="å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨" aria-hidden="true">#</a> å­˜å‚¨</h2><h3 id="config-map" tabindex="-1"><a class="header-anchor" href="#config-map" aria-hidden="true">#</a> config map</h3><p>k:æ–‡ä»¶å v:æ–‡ä»¶å†…å®¹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create configmap xxx --from-file=/xxxx --from-liberal=kk=vv
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="secret" tabindex="-1"><a class="header-anchor" href="#secret" aria-hidden="true">#</a> secret</h3><ul><li>service account: è®¿é—® k8s api, é»˜è®¤æŒ‚è½½åˆ° pod çš„<code>/run/secrets/kubernets.io/serviceaccount/</code>ä¸­</li><li>opaque: base64 ç¼–ç </li><li>docker config json: ç”¨äº registry è®¤è¯</li></ul><h3 id="volume" tabindex="-1"><a class="header-anchor" href="#volume" aria-hidden="true">#</a> volume</h3><ul><li>emptyDir :æš‚å­˜,åˆ å…‰ pod å°±æ²¡äº†</li><li>hostPath: æŒ‚è½½ä¸»æœºç›®å½•</li></ul><h3 id="pv-pvc" tabindex="-1"><a class="header-anchor" href="#pv-pvc" aria-hidden="true">#</a> pv/pvc</h3><ul><li>å›æ”¶ç­–ç•¥</li><li>è¯»å†™ç­–ç•¥</li></ul><p>statefulset/deployment---&gt;pvc æ¨¡æ¿----&gt;é€‰æ‹©ç¬¦åˆæ¡ä»¶çš„ pv</p><h2 id="å·¥ä½œè´Ÿè½½" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œè´Ÿè½½" aria-hidden="true">#</a> å·¥ä½œè´Ÿè½½</h2><h3 id="replication-controllers" tabindex="-1"><a class="header-anchor" href="#replication-controllers" aria-hidden="true">#</a> Replication Controllers</h3><p>åºŸå¼ƒ</p><h3 id="replica-sets" tabindex="-1"><a class="header-anchor" href="#replica-sets" aria-hidden="true">#</a> Replica Sets</h3><p>æ”¯æŒ selector, ç®¡ç† pods çš„åˆ›å»ºè°ƒåº¦</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> guestbook
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># modify replicas according to your case</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> php<span class="token punctuation">-</span>redis
          <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google_samples/gb<span class="token punctuation">-</span>frontend<span class="token punctuation">:</span>v3
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="deployment" tabindex="-1"><a class="header-anchor" href="#deployment" aria-hidden="true">#</a> Deployment</h3><p>é€šè¿‡ replica sets ç®¡ç† pods, å›æ»š æ›´æ–°ç­‰ç­‰</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="daemon-sets" tabindex="-1"><a class="header-anchor" href="#daemon-sets" aria-hidden="true">#</a> Daemon Sets</h3><p>æ‰€æœ‰ node æˆ–æŸäº› node èŠ‚ç‚¹éƒ½è¿è¡ŒæŸä¸€ä¸ª pod</p><h3 id="stateful-sets" tabindex="-1"><a class="header-anchor" href="#stateful-sets" aria-hidden="true">#</a> Stateful Sets</h3><p>æœ‰çŠ¶æ€æœåŠ¡,podname hostname é‡æ–°è°ƒåº¦åä¸ä¼šæ”¹å˜ æœ‰åºéƒ¨ç½² ä¼¸ç¼©</p><h3 id="cron-jobs" tabindex="-1"><a class="header-anchor" href="#cron-jobs" aria-hidden="true">#</a> Cron Jobs</h3><p>å®šæ—¶ä»»åŠ¡</p><h3 id="jobs" tabindex="-1"><a class="header-anchor" href="#jobs" aria-hidden="true">#</a> Jobs</h3><p>æ‰¹å¤„ç†ä»»åŠ¡,æ‰§è¡Œå¤±è´¥çš„å¯ä»¥é‡æ–°æ‰§è¡Œ</p><h3 id="hpa" tabindex="-1"><a class="header-anchor" href="#hpa" aria-hidden="true">#</a> hpa</h3><p>è‡ªåŠ¨ä¼¸ç¼©</p><h2 id="è°ƒåº¦å™¨" tabindex="-1"><a class="header-anchor" href="#è°ƒåº¦å™¨" aria-hidden="true">#</a> è°ƒåº¦å™¨</h2><p><code>Scheduler</code>: åˆ†é… pod åˆ°åˆé€‚çš„èŠ‚ç‚¹</p><h3 id="è°ƒåº¦è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#è°ƒåº¦è¿‡ç¨‹" aria-hidden="true">#</a> è°ƒåº¦è¿‡ç¨‹</h3><ol><li>é¢„é€‰,æ’é™¤ä¸ç¬¦åˆçš„èŠ‚ç‚¹</li><li>ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹æ’åº</li></ol><h3 id="affinity" tabindex="-1"><a class="header-anchor" href="#affinity" aria-hidden="true">#</a> affinity</h3><p><code>èŠ‚ç‚¹äº²å’Œæ€§/podäº²å’Œæ€§</code> æ ‡ç­¾åŒ¹é…</p><p>node hostname æ ‡ç­¾ : <code>kubernetes.io/hostname</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>node<span class="token punctuation">-</span>affinity
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/e2e<span class="token punctuation">-</span>az<span class="token punctuation">-</span>name
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az1
                  <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az2
      <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">preference</span><span class="token punctuation">:</span>
            <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>key
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>value
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>node<span class="token punctuation">-</span>affinity
      <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/pause<span class="token punctuation">:</span><span class="token number">2.0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="taint-toleration" tabindex="-1"><a class="header-anchor" href="#taint-toleration" aria-hidden="true">#</a> taint/toleration</h3><p><code>æ±¡ç‚¹/å®¹å¿</code></p><p>k=v(å¯ä»¥ä¸ºç©º):effect(noschedule prefernoschedule noExecute)</p><p><code>kubectl taint ndoes xxx k=v:effect</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span>
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> <span class="token string">&quot;Equal&quot;</span>
    <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;xxxx&quot;</span>
    <span class="token key atrule">effect</span><span class="token punctuation">:</span> <span class="token string">&quot;NoSchedule&quot;</span>
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">7200</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="æŒ‡å®šèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šèŠ‚ç‚¹" aria-hidden="true">#</a> æŒ‡å®šèŠ‚ç‚¹</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span>
<span class="token punctuation">---</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> value <span class="token comment"># label</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="å®‰å…¨æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨æ§åˆ¶" aria-hidden="true">#</a> å®‰å…¨æ§åˆ¶</h3><ol><li>authentication</li><li>authorization</li><li>admission control</li></ol><h3 id="rbac" tabindex="-1"><a class="header-anchor" href="#rbac" aria-hidden="true">#</a> rbac</h3><ul><li>Role</li><li>ClusterRole</li><li>RoleBinding</li><li>ClusterRoleBinding</li></ul><h2 id="yaml-é…ç½®" tabindex="-1"><a class="header-anchor" href="#yaml-é…ç½®" aria-hidden="true">#</a> yaml é…ç½®</h2><h3 id="version" tabindex="-1"><a class="header-anchor" href="#version" aria-hidden="true">#</a> version</h3><p><code>å¿…é¡»æœ‰</code> <code>apps/v1</code> <code>kubectl api-versions</code></p><h3 id="kind" tabindex="-1"><a class="header-anchor" href="#kind" aria-hidden="true">#</a> kind</h3><p>èµ„æºç±»å‹: <code>Pod</code> <code>Deployment</code>ç­‰</p><h3 id="metadata" tabindex="-1"><a class="header-anchor" href="#metadata" aria-hidden="true">#</a> metadata</h3><ul><li>name</li><li>namespace é»˜è®¤ default</li><li>labels</li></ul><h3 id="spec" tabindex="-1"><a class="header-anchor" href="#spec" aria-hidden="true">#</a> spec</h3><p>èµ„æºè¯¦ç»†ä¿¡æ¯</p><ul><li><p>initContainers: init å®¹å™¨,ä¾æ¬¡å¯åŠ¨</p></li><li><p>containers : å®¹å™¨é›†åˆ</p><ul><li>name</li><li>image</li><li>imagePullPolicy:always never ifnotpresent</li><li>command: å®¹å™¨å¯åŠ¨å‘½ä»¤</li><li>args</li><li>workingDir</li><li>volumeMounts: å­˜å‚¨å·, name path ç­‰ç­‰</li><li>ports: ç«¯å£é›†åˆ <ul><li>name: ç«¯å£åç§°</li><li>containerPort: å®¹å™¨ç›‘å¬ç«¯å£</li><li>hostPort: ä¸»æœºç›‘å¬ç«¯å£,é»˜è®¤ä¸ containerPort ä¸€è‡´</li><li>protocol: tcp/udp</li></ul></li><li>env: ç¯å¢ƒå˜é‡</li><li>resources: èµ„æºé™åˆ¶</li></ul></li><li><p>restartPolicy: pod é‡å¯ç­–ç•¥ always onfailure never</p></li><li><p>nodeSelector: k/v æ ‡ç­¾, node è¿‡æ»¤æ ‡ç­¾</p></li><li><p>imagePullSecrets: pull image æ—¶çš„ secret</p></li><li><p>hostNetwork: æ˜¯å¦ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ é»˜è®¤ false</p></li></ul><h2 id="helm" tabindex="-1"><a class="header-anchor" href="#helm" aria-hidden="true">#</a> Helm</h2><blockquote><p>åŒ…ç®¡ç†å·¥å…·, heml3 ç§»é™¤äº† tiller</p></blockquote><h3 id="chart" tabindex="-1"><a class="header-anchor" href="#chart" aria-hidden="true">#</a> chart</h3><p>åº”ç”¨ä¿¡æ¯é›†åˆ,å„ç§é…ç½®</p><h3 id="release" tabindex="-1"><a class="header-anchor" href="#release" aria-hidden="true">#</a> release</h3><p>chart çš„å®ä¾‹</p><h3 id="è‡ªå®šä¹‰-chart" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰-chart" aria-hidden="true">#</a> è‡ªå®šä¹‰ chart</h3><ol><li><code>Chart.yaml</code></li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># name versionå¿…é¡»æœ‰</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> xxxx
<span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.0
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>åˆ›å»º k8s yaml æ–‡ä»¶</li></ol><p><code>./templates/deployment.yaml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token comment">#  ...</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>./templates/service.yaml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># service yamlé…ç½®</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>å¯åŠ¨</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm create xxx  <span class="token comment"># åˆ›å»ºchartç›®å½•å’Œchartç”¨åˆ°çš„å…¬å…±æ–‡ä»¶ç›®å½•ç»“æ„</span>

helm lint xxx   <span class="token comment"># æ£€æŸ¥é…ç½®</span>

helm <span class="token function">install</span> --set <span class="token assign-left variable">name</span><span class="token operator">=</span>xxx <span class="token builtin class-name">.</span>

helm <span class="token function">install</span> -n xxx -namespace vvv <span class="token builtin class-name">.</span>

helm list

helm upgrade xxxx
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="values" tabindex="-1"><a class="header-anchor" href="#values" aria-hidden="true">#</a> Values</h3><p><code>valuse.yaml</code> å®šä¹‰å˜é‡ä¿¡æ¯</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">xxx</span><span class="token punctuation">:</span> test
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>k8s.yaml</code> ä¸­å¼•ç”¨:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">xx</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> .Values.xxx <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/vbeats/vblog/edit/next/cloud/base/k8s.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/12/8 ä¸Šåˆ8:04:33</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: bootvue@gmail.com">bootvue</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/cloud/base/rancher.html" class="nav-link" aria-label="Rancher ğŸ„"><!--[--><!--]--> Rancher ğŸ„ <!--[--><!--]--></a> â†’ </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.6686f77d.js" defer></script><script src="/assets/js/7.3d9f59d0.js" defer></script><script src="/assets/js/app.42261b4c.js" defer></script>
  </body>
</html>
