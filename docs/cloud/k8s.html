<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K8s | 码步鱼</title>
    <meta name="description" content="java node nodejs typescript k8s golang python react native vue vue3 flutter uni-app taro 后端 前端 app 小程序 运维 微服务 架构 微信 博客 笔记">
    <link rel="stylesheet" href="/assets/style.5034d561.css">
    <link rel="modulepreload" href="/assets/Home.5a04b05a.js">
    <link rel="modulepreload" href="/assets/app.8862131a.js">
    <link rel="modulepreload" href="/assets/cloud_k8s.md.8ce18cdf.lean.js">
    <link rel="modulepreload" href="/assets/app.8862131a.js">
    <meta name="twitter:title" content="K8s | 码步鱼">
    <meta property="og:title" content="K8s | 码步鱼">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6898e0ee><div class="sidebar-button" data-v-6898e0ee><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="码步鱼, back to home" data-v-6898e0ee data-v-7ac13a1e><!----> 码步鱼</a><div class="flex-grow" data-v-6898e0ee></div><div class="nav" data-v-6898e0ee><nav class="nav-links" data-v-6898e0ee data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/" data-v-792310f6>首页 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/language/" data-v-792310f6>语言基础 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/article/" data-v-792310f6>文章 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/open/" data-v-792310f6>OpenSource <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/micro/" data-v-792310f6>微服务 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item active" href="/cloud/" data-v-792310f6>云 ☁️ <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/other/" data-v-792310f6>杂七杂八 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item isExternal" href="https://github.com/vbeats" target="_blank" rel="noopener noreferrer" data-v-792310f6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-792310f6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-71f182b0><nav class="nav-links nav" data-v-71f182b0 data-v-640fc9fc><!--[--><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/" data-v-792310f6>首页 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/language/" data-v-792310f6>语言基础 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/article/" data-v-792310f6>文章 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/open/" data-v-792310f6>OpenSource <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/micro/" data-v-792310f6>微服务 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item active" href="/cloud/" data-v-792310f6>云 ☁️ <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item" href="/other/" data-v-792310f6>杂七杂八 <!----></a></div></div><div class="item" data-v-640fc9fc><div class="nav-link" data-v-640fc9fc data-v-792310f6><a class="item isExternal" href="https://github.com/vbeats" target="_blank" rel="noopener noreferrer" data-v-792310f6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-792310f6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-71f182b0><!--[--><li class="sidebar-link"><p class="sidebar-link-item">云原生</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/cloud/index">文档</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/cloud/k8s">k8s</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#k8s">K8s</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#kubeadm-引导集群">kubeadm 引导集群</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#初始化集群">初始化集群</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#dashboard">dashboard</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#高可用集群">高可用集群</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#kubectl">kubectl</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#pod">pod</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#生命周期">生命周期</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#状态检测">状态检测</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#类型">类型</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#服务发现">服务发现</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#port">port</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#headless-service">headless service</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#externalname">ExternalName</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ingress-负载均衡器">ingress 负载均衡器</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#存储">存储</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#config-map">config map</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#secret">secret</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#volume">volume</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#pv-pvc">pv/pvc</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#工作负载">工作负载</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#replication-controllers">Replication Controllers</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#replica-sets">Replica Sets</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#deployment">Deployment</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#daemon-sets">Daemon Sets</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#stateful-sets">Stateful Sets</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#cron-jobs">Cron Jobs</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#jobs">Jobs</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#hpa">hpa</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#调度器">调度器</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#调度过程">调度过程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#affinity">affinity</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#taint-toleration">taint/toleration</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#指定节点">指定节点</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#安全控制">安全控制</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#rbac">rbac</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#yaml-配置">yaml 配置</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#version">version</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#kind">kind</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#metadata">metadata</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#spec">spec</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#helm">Helm</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#chart">chart</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#release">release</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义-chart">自定义 chart</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#values">Values</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/cloud/rancher">rancher</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h2 id="k8s"><a class="header-anchor" href="#k8s" aria-hidden="true">#</a> K8s</h2><ul><li>节点（Node）：一个节点是一个运行 Kubernetes 中的主机。</li><li>容器组（Pod）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。</li><li>容器组生命周期（pos-states）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。</li><li>Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行 废弃</li><li>服务（services）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。</li><li>卷（volumes）：一个卷就是一个目录，容器对其有访问权限。</li><li>标签（labels）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。</li><li>接口权限（accessing_the_api）：端口，IP 地址和代理的防火墙规则。</li><li>web 界面（ux）：用户可以通过 web 界面操作 Kubernetes。</li><li>命令行操作（cli）：kubectl 命令。</li></ul><h3 id="kubeadm-引导集群"><a class="header-anchor" href="#kubeadm-引导集群" aria-hidden="true">#</a> kubeadm 引导集群</h3><blockquote><p>image registry: <code>registry.aliyuncs.com/google_containers</code></p></blockquote><blockquote><p>1master 2 node</p></blockquote><table><thead><tr><th>Node</th><th>role</th></tr></thead><tbody><tr><td>192.168.100.80</td><td>control-plane,master</td></tr><tr><td>192.168.100.81</td><td>worker</td></tr><tr><td>192.168.100.82</td><td>worker</td></tr></tbody></table><h3 id="初始化集群"><a class="header-anchor" href="#初始化集群" aria-hidden="true">#</a> 初始化集群</h3><ol><li>安装<code>kubeadm</code> <code>kubelet</code> <code>kubectl</code> , <code>kubelet</code>设为自启动</li><li><code>kubeadm</code> 初始化<code>control-plane</code> <code>etcd</code></li></ol><div class="language-bash"><pre><code>kubeadm config print init-defaults <span class="token operator">&gt;</span> k8s.yaml
</code></pre></div><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">bootstrapTokens</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> system<span class="token punctuation">:</span>bootstrappers<span class="token punctuation">:</span>kubeadm<span class="token punctuation">:</span>default<span class="token punctuation">-</span>node<span class="token punctuation">-</span>token
    <span class="token key atrule">token</span><span class="token punctuation">:</span> abcdef.0123456789abcdef
    <span class="token key atrule">ttl</span><span class="token punctuation">:</span> 24h0m0s
    <span class="token key atrule">usages</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> signing
      <span class="token punctuation">-</span> authentication
<span class="token key atrule">kind</span><span class="token punctuation">:</span> InitConfiguration
<span class="token key atrule">localAPIEndpoint</span><span class="token punctuation">:</span>
  <span class="token key atrule">advertiseAddress</span><span class="token punctuation">:</span> 192.168.100.80
  <span class="token key atrule">bindPort</span><span class="token punctuation">:</span> <span class="token number">6443</span>
<span class="token key atrule">nodeRegistration</span><span class="token punctuation">:</span>
  <span class="token key atrule">criSocket</span><span class="token punctuation">:</span> /var/run/dockershim.sock
  <span class="token key atrule">name</span><span class="token punctuation">:</span> master
  <span class="token key atrule">taints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
<span class="token punctuation">---</span>
<span class="token key atrule">apiServer</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeoutForControlPlane</span><span class="token punctuation">:</span> 4m0s
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">certificatesDir</span><span class="token punctuation">:</span> /etc/kubernetes/pki
<span class="token key atrule">clusterName</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">controllerManager</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">dns</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> CoreDNS
<span class="token key atrule">etcd</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataDir</span><span class="token punctuation">:</span> /var/lib/etcd
<span class="token key atrule">imageRepository</span><span class="token punctuation">:</span> k8s.gcr.io
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration
<span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> v1.20.0
<span class="token key atrule">networking</span><span class="token punctuation">:</span>
  <span class="token key atrule">dnsDomain</span><span class="token punctuation">:</span> cluster.local
  <span class="token key atrule">serviceSubnet</span><span class="token punctuation">:</span> 10.96.0.0/12
  <span class="token key atrule">podSubnet</span><span class="token punctuation">:</span> 10.244.0.0/16
<span class="token key atrule">scheduler</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>下载必要的组件</li></ol><div class="language-bash"><pre><code>kubeadm config images list --config ./k8s.yaml


<span class="token comment"># k8s.gcr.io/kube-apiserver:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-controller-manager:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-scheduler:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/kube-proxy:v1.20.0</span>
<span class="token comment"># k8s.gcr.io/pause:3.2</span>
<span class="token comment"># k8s.gcr.io/etcd:3.4.13-0</span>
<span class="token comment"># k8s.gcr.io/coredns:1.7.0</span>


kubeadm config images pull --config ./k8s.yaml
</code></pre></div><ol start="4"><li>初始化<code>control-plane</code></li></ol><div class="language-bash"><pre><code>kubeadm init --config ./k8s.yaml

<span class="token comment">#  其他节点最后加入</span>
<span class="token function">sudo</span> kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.100.80:6443 --token abcdef.0123456789abcdef <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:8a8e18afb8aaa05d35305bd7d65e50542d5673032fcb0988089a298fe330cea3

</code></pre></div><ol start="5"><li>环境变量</li></ol><div class="language-bash"><pre><code><span class="token comment"># 非 root 用户使 `kubectl` 命令   admin.conf从control-plane节点同步到其它worker节点</span>
  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

<span class="token comment"># root用户</span>

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf

</code></pre></div><ol start="6"><li>集群 pod 网关通信组件</li></ol><blockquote><p>第三方有多种实现</p></blockquote><p><a href="https://github.com/coreos/flannel" target="_blank" rel="noopener noreferrer">flannel</a></p><div class="language-bash"><pre><code><span class="token comment"># 集群主节点执行即可</span>
kubectl apply -f flannel.yaml  <span class="token comment"># 镜像需要拉取</span>
</code></pre></div><h3 id="dashboard"><a class="header-anchor" href="#dashboard" aria-hidden="true">#</a> dashboard</h3><p><a href="https://github.com/kubernetes/dashboard/" target="_blank" rel="noopener noreferrer">dashboard</a></p><div class="language-bash"><pre><code><span class="token comment"># port需要开放</span>
kubectl edit services kubernetes-dashboard -n kubernetes-dashboard

<span class="token comment"># type: NodePort</span>
</code></pre></div><h3 id="高可用集群"><a class="header-anchor" href="#高可用集群" aria-hidden="true">#</a> 高可用集群</h3><p>上云吧</p><h2 id="kubectl"><a class="header-anchor" href="#kubectl" aria-hidden="true">#</a> kubectl</h2><p><code>kubectl create/apply -f xxx.yaml --record</code> create 与 apply : apply 更新 create 新建,已存在报错 record 记录每次变化</p><p><code>kubectl get pods -o wide -n xkube-system</code> : namespace</p><p><code>kubectl logs podName -c containerName -n kube-system</code>: 查看某个 pod 日志</p><p><code>kubectl describe pod xxxx -n kube-system</code>:查看 pod 详细信息</p><p><code>kubectl get/delete namespace/namespaces/ns/services/svc/deploy/secrets/pods -n xxxx -o yaml/wide</code> : services:svc deployment: deploy ns:namespace</p><p><code>kubectl scale deployment/deployName --replicas=3</code> : 伸缩</p><p><code>kubectl set image deployment/deployName xxx/vvv:latest</code>:更新 deploy 镜像</p><p><code>kubectl rollout undo deployment/deployName --to-revesion=2</code>:回滚到某次的状态 默认上一次</p><p><code>kubectl rollout status deployment/deployName</code>:查看回滚状态</p><p><code>kubectl rollout history deployment/deployName</code>:查看部署历史</p><p><code>kubectl explain spec.xx</code> : 查看 yaml 配置模板</p><p><code>kubectl exit pod/svc xxx</code>: 编辑资源 yaml, 修改某些字段可能无效</p><p><code>kubectl exec podName -c containerName -it -- /bin/bash</code> :进入 pod 容器内</p><p><code>kubectl label pod xxx k=v --override=true</code>: 修改某个资源的 label</p><p><code>kubectl expose deployment xxxx --port=80 --target-port=80</code></p><ul><li>svc 绑定端口 port/对外暴露端口 target-port/容器内端口 默认一致 node-port/外部可以访问的端口</li><li>默认 type: ClusterIP 集群内访问 NodePort:外部可以访问</li></ul><p><code>kubectl create configmap xxx --from-file=/xxxx</code> :configmap</p><p><code>kubectl get cm/confgmap</code></p><p><code>kubectl taint ndoes xxx k=v:effect</code>: 设置污点</p><h2 id="pod"><a class="header-anchor" href="#pod" aria-hidden="true">#</a> pod</h2><h3 id="生命周期"><a class="header-anchor" href="#生命周期" aria-hidden="true">#</a> 生命周期</h3><div class="language-bash"><pre><code>pause启动<span class="token punctuation">(</span>完成网络与volume初始化<span class="token punctuation">)</span>
init初始化<span class="token punctuation">(</span>依次,上一个成功才开始下一个<span class="token punctuation">)</span>  start<span class="token punctuation">(</span>postStart<span class="token punctuation">)</span>  run  stop<span class="token punctuation">(</span>preStop<span class="token punctuation">)</span>   readines:就绪检测 liveness: 存活检测

init初始化失败,会按照容器重启策略重启

正在初始化的状态为pending

initContainers name不能重复
</code></pre></div><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>pod
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo The app is running! &amp;&amp; sleep 3600&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>myservice
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;until nslookup myservice; do echo waiting for myservice; sleep 2; done;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>mydb
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;until nslookup mydb; do echo waiting for mydb; sleep 2; done;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
</code></pre></div><h3 id="状态检测"><a class="header-anchor" href="#状态检测" aria-hidden="true">#</a> 状态检测</h3><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> readiness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> readiness<span class="token punctuation">-</span>http
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> readiness<span class="token punctuation">-</span>http
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
        <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /health
          <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
</code></pre></div><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>http
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>http
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
        <span class="token key atrule">postStart</span><span class="token punctuation">:</span>
          <span class="token key atrule">exec</span><span class="token punctuation">:</span>
            <span class="token key atrule">command</span><span class="token punctuation">:</span>
              <span class="token punctuation">[</span>
                <span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;echo liveness-http test &gt; /usr/share/nginx/html/health&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span>
      <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
        <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /health
          <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
</code></pre></div><h3 id="类型"><a class="header-anchor" href="#类型" aria-hidden="true">#</a> 类型</h3><p><code>自主pod</code>:退出了就拉倒 <code>控制器管理的pod</code>:按控制器策略创建</p><h2 id="服务发现"><a class="header-anchor" href="#服务发现" aria-hidden="true">#</a> 服务发现</h2><p>pod 资源的抽象 label-selector 对 pod 逻辑分组</p><h3 id="port"><a class="header-anchor" href="#port" aria-hidden="true">#</a> port</h3><ul><li>ClusterPort 集群内</li><li>NodePort 每个 node 节点都绑定端口对外服务</li><li>LoadBalancer</li><li>ExternalName 集群外部服务引入到集群内部来</li></ul><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> MyApp
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9376</span>
</code></pre></div><h3 id="headless-service"><a class="header-anchor" href="#headless-service" aria-hidden="true">#</a> headless service</h3><p>有状态服务使用</p><h3 id="externalname"><a class="header-anchor" href="#externalname" aria-hidden="true">#</a> ExternalName</h3><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> prod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ExternalName
  <span class="token key atrule">externalName</span><span class="token punctuation">:</span> my.database.example.com
</code></pre></div><h3 id="ingress-负载均衡器"><a class="header-anchor" href="#ingress-负载均衡器" aria-hidden="true">#</a> ingress 负载均衡器</h3><p><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">nginx-ingress</a></p><h2 id="存储"><a class="header-anchor" href="#存储" aria-hidden="true">#</a> 存储</h2><h3 id="config-map"><a class="header-anchor" href="#config-map" aria-hidden="true">#</a> config map</h3><p>k:文件名 v:文件内容</p><div class="language-"><pre><code>kubectl create configmap xxx --from-file=/xxxx --from-liberal=kk=vv
</code></pre></div><h3 id="secret"><a class="header-anchor" href="#secret" aria-hidden="true">#</a> secret</h3><ul><li>service account: 访问 k8s api, 默认挂载到 pod 的<code>/run/secrets/kubernets.io/serviceaccount/</code>中</li><li>opaque: base64 编码</li><li>docker config json: 用于 registry 认证</li></ul><h3 id="volume"><a class="header-anchor" href="#volume" aria-hidden="true">#</a> volume</h3><ul><li>emptyDir :暂存,删光 pod 就没了</li><li>hostPath: 挂载主机目录</li></ul><h3 id="pv-pvc"><a class="header-anchor" href="#pv-pvc" aria-hidden="true">#</a> pv/pvc</h3><ul><li>回收策略</li><li>读写策略</li></ul><p>statefulset/deployment—&gt;pvc 模板----&gt;选择符合条件的 pv</p><h2 id="工作负载"><a class="header-anchor" href="#工作负载" aria-hidden="true">#</a> 工作负载</h2><h3 id="replication-controllers"><a class="header-anchor" href="#replication-controllers" aria-hidden="true">#</a> Replication Controllers</h3><p>废弃</p><h3 id="replica-sets"><a class="header-anchor" href="#replica-sets" aria-hidden="true">#</a> Replica Sets</h3><p>支持 selector, 管理 pods 的创建调度</p><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> guestbook
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># modify replicas according to your case</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> php<span class="token punctuation">-</span>redis
          <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google_samples/gb<span class="token punctuation">-</span>frontend<span class="token punctuation">:</span>v3
</code></pre></div><h3 id="deployment"><a class="header-anchor" href="#deployment" aria-hidden="true">#</a> Deployment</h3><p>通过 replica sets 管理 pods, 回滚 更新等等</p><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><h3 id="daemon-sets"><a class="header-anchor" href="#daemon-sets" aria-hidden="true">#</a> Daemon Sets</h3><p>所有 node 或某些 node 节点都运行某一个 pod</p><h3 id="stateful-sets"><a class="header-anchor" href="#stateful-sets" aria-hidden="true">#</a> Stateful Sets</h3><p>有状态服务,podname hostname 重新调度后不会改变 有序部署 伸缩</p><h3 id="cron-jobs"><a class="header-anchor" href="#cron-jobs" aria-hidden="true">#</a> Cron Jobs</h3><p>定时任务</p><h3 id="jobs"><a class="header-anchor" href="#jobs" aria-hidden="true">#</a> Jobs</h3><p>批处理任务,执行失败的可以重新执行</p><h3 id="hpa"><a class="header-anchor" href="#hpa" aria-hidden="true">#</a> hpa</h3><p>自动伸缩</p><h2 id="调度器"><a class="header-anchor" href="#调度器" aria-hidden="true">#</a> 调度器</h2><p><code>Scheduler</code>: 分配 pod 到合适的节点</p><h3 id="调度过程"><a class="header-anchor" href="#调度过程" aria-hidden="true">#</a> 调度过程</h3><ol><li>预选,排除不符合的节点</li><li>符合条件的节点排序</li></ol><h3 id="affinity"><a class="header-anchor" href="#affinity" aria-hidden="true">#</a> affinity</h3><p><code>节点亲和性/pod亲和性</code> 标签匹配</p><p>node hostname 标签 : <code>kubernetes.io/hostname</code></p><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>node<span class="token punctuation">-</span>affinity
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/e2e<span class="token punctuation">-</span>az<span class="token punctuation">-</span>name
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az1
                  <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az2
      <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">preference</span><span class="token punctuation">:</span>
            <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>key
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>value
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>node<span class="token punctuation">-</span>affinity
      <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/pause<span class="token punctuation">:</span><span class="token number">2.0</span>
</code></pre></div><h3 id="taint-toleration"><a class="header-anchor" href="#taint-toleration" aria-hidden="true">#</a> taint/toleration</h3><p><code>污点/容忍</code></p><p>k=v(可以为空):effect(noschedule prefernoschedule noExecute)</p><p><code>kubectl taint ndoes xxx k=v:effect</code></p><div class="language-yaml"><pre><code><span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span>
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> <span class="token string">&quot;Equal&quot;</span>
    <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;xxxx&quot;</span>
    <span class="token key atrule">effect</span><span class="token punctuation">:</span> <span class="token string">&quot;NoSchedule&quot;</span>
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">7200</span>
</code></pre></div><h3 id="指定节点"><a class="header-anchor" href="#指定节点" aria-hidden="true">#</a> 指定节点</h3><div class="language-yaml"><pre><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span>
<span class="token punctuation">---</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> value <span class="token comment"># label</span>
</code></pre></div><h3 id="安全控制"><a class="header-anchor" href="#安全控制" aria-hidden="true">#</a> 安全控制</h3><ol><li>authentication</li><li>authorization</li><li>admission control</li></ol><h3 id="rbac"><a class="header-anchor" href="#rbac" aria-hidden="true">#</a> rbac</h3><ul><li>Role</li><li>ClusterRole</li><li>RoleBinding</li><li>ClusterRoleBinding</li></ul><h2 id="yaml-配置"><a class="header-anchor" href="#yaml-配置" aria-hidden="true">#</a> yaml 配置</h2><h3 id="version"><a class="header-anchor" href="#version" aria-hidden="true">#</a> version</h3><p><code>必须有</code> <code>apps/v1</code> <code>kubectl api-versions</code></p><h3 id="kind"><a class="header-anchor" href="#kind" aria-hidden="true">#</a> kind</h3><p>资源类型: <code>Pod</code> <code>Deployment</code>等</p><h3 id="metadata"><a class="header-anchor" href="#metadata" aria-hidden="true">#</a> metadata</h3><ul><li>name</li><li>namespace 默认 default</li><li>labels</li></ul><h3 id="spec"><a class="header-anchor" href="#spec" aria-hidden="true">#</a> spec</h3><p>资源详细信息</p><ul><li><p>initContainers: init 容器,依次启动</p></li><li><p>containers : 容器集合</p><ul><li>name</li><li>image</li><li>imagePullPolicy:always never ifnotpresent</li><li>command: 容器启动命令</li><li>args</li><li>workingDir</li><li>volumeMounts: 存储卷, name path 等等</li><li>ports: 端口集合 <ul><li>name: 端口名称</li><li>containerPort: 容器监听端口</li><li>hostPort: 主机监听端口,默认与 containerPort 一致</li><li>protocol: tcp/udp</li></ul></li><li>env: 环境变量</li><li>resources: 资源限制</li></ul></li><li><p>restartPolicy: pod 重启策略 always onfailure never</p></li><li><p>nodeSelector: k/v 标签, node 过滤标签</p></li><li><p>imagePullSecrets: pull image 时的 secret</p></li><li><p>hostNetwork: 是否使用宿主机网络 默认 false</p></li></ul><h2 id="helm"><a class="header-anchor" href="#helm" aria-hidden="true">#</a> Helm</h2><blockquote><p>包管理工具, heml3 移除了 tiller</p></blockquote><h3 id="chart"><a class="header-anchor" href="#chart" aria-hidden="true">#</a> chart</h3><p>应用信息集合,各种配置</p><h3 id="release"><a class="header-anchor" href="#release" aria-hidden="true">#</a> release</h3><p>chart 的实例</p><h3 id="自定义-chart"><a class="header-anchor" href="#自定义-chart" aria-hidden="true">#</a> 自定义 chart</h3><ol><li><code>Chart.yaml</code></li></ol><div class="language-yaml"><pre><code><span class="token comment"># name version必须有</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> xxxx
<span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.0
</code></pre></div><ol start="2"><li>创建 k8s yaml 文件</li></ol><p><code>./templates/deployment.yaml</code></p><div class="language-yaml"><pre><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token comment">#  ...</span>
</code></pre></div><p><code>./templates/service.yaml</code></p><div class="language-yaml"><pre><code><span class="token comment"># service yaml配置</span>
</code></pre></div><ol start="3"><li>启动</li></ol><div class="language-bash"><pre><code>helm create xxx  <span class="token comment"># 创建chart目录和chart用到的公共文件目录结构</span>

helm lint xxx   <span class="token comment"># 检查配置</span>

helm <span class="token function">install</span> --set <span class="token assign-left variable">name</span><span class="token operator">=</span>xxx <span class="token builtin class-name">.</span>

helm <span class="token function">install</span> -n xxx -namespace vvv <span class="token builtin class-name">.</span>

helm list

helm upgrade xxxx
</code></pre></div><h3 id="values"><a class="header-anchor" href="#values" aria-hidden="true">#</a> Values</h3><p><code>valuse.yaml</code> 定义变量信息</p><div class="language-yaml"><pre><code><span class="token key atrule">xxx</span><span class="token punctuation">:</span> test
</code></pre></div><p><code>k8s.yaml</code> 中引用:</p><div class="language-yaml"><pre><code><span class="token key atrule">xx</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> .Values.xxx <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/cloud/" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>文档</span></a></div><div class="next" data-v-e65a9748><a class="link" href="/cloud/rancher" data-v-e65a9748><span class="text" data-v-e65a9748>rancher</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-e65a9748><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"2ffeea8e\",\"index.md\":\"c9b3ba09\",\"article_index.md\":\"3e43a6a0\",\"article_sts.md\":\"74d23725\",\"cloud_index.md\":\"f2d9b85f\",\"cloud_k8s.md\":\"8ce18cdf\",\"cloud_rancher.md\":\"f1f998c7\",\"language_canvas.md\":\"be53b6f0\",\"language_chrome.md\":\"2fc18500\",\"language_flink.md\":\"29fe466c\",\"language_flutter.md\":\"4247246a\",\"language_index.md\":\"872672da\",\"language_jvm.md\":\"f7f94c4f\",\"language_kafka.md\":\"845409de\",\"language_mongo.md\":\"22c32a50\",\"language_node.md\":\"de5393f1\",\"language_python.md\":\"d0b88d1b\",\"language_react.md\":\"b97d3bfc\",\"language_redis.md\":\"1adc2a24\",\"language_rocket.md\":\"4e7e9c30\",\"language_socketio.md\":\"4f708754\",\"language_typescript.md\":\"4421a287\",\"language_webpack.md\":\"0d848452\",\"language_zookeeper.md\":\"7146236a\",\"micro_index.md\":\"482de1a8\",\"open_elk.md\":\"221d4ba7\",\"open_hadoop.md\":\"81fd9da8\",\"open_hdfs.md\":\"cfd129c2\",\"open_index.md\":\"c23fbf1c\",\"open_kong.md\":\"6d1c9c3e\",\"open_mapreduce.md\":\"a7fb9d2e\",\"open_mysql.md\":\"90483ea2\",\"open_netty.md\":\"f1b54de1\",\"open_proxy.md\":\"bd0cb4ca\",\"other_index.md\":\"6185da7e\",\"other_linux.md\":\"1281c7d6\",\"other_nginx.md\":\"5cb8e41d\",\"other_other.md\":\"ad2e8a31\",\"other_shell.md\":\"75a2b9af\",\"other_wireshark.md\":\"431fbe7e\",\"other_xianyu.md\":\"fad93c41\"}")</script>
    <script type="module" async src="/assets/app.8862131a.js"></script>
  </body>
</html>