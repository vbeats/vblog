import{e as n}from"./app.07c9c92c.js";import{_ as a}from"./plugin-vue_export-helper.21dcd24c.js";const s={},e=n(`<h1 id="rabbitmq" tabindex="-1"><a class="header-anchor" href="#rabbitmq" aria-hidden="true">#</a> RabbitMQ</h1><h2 id="\u6CE8\u610F" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F" aria-hidden="true">#</a> \u6CE8\u610F:</h2><ol><li>\u5982\u679C\u4E0D\u6307\u5B9A exchange, \u9ED8\u8BA4\u8D70 amqp default exchange, ==routing-key==\u4E0E==queue==\u540D\u5339\u914D\u4E00\u81F4\u6295\u9012</li></ol><h2 id="exchange-\u4EA4\u6362\u673A" tabindex="-1"><a class="header-anchor" href="#exchange-\u4EA4\u6362\u673A" aria-hidden="true">#</a> exchange \u4EA4\u6362\u673A</h2><ol><li>direct: ==routing-key==\u5FC5\u987B\u5B8C\u5168\u5339\u914D</li><li>topic: ==routing-key==\u6A21\u7CCA\u5339\u914D</li></ol><blockquote><p>#\u5339\u914D\u591A\u4E2A\u8BCD *\u5339\u914D\u4E00\u4E2A\u8BCD</p></blockquote><ol start="3"><li>fanout: ==\u4E0D\u5904==\u7406 routing-key, exchange \u4E0E queue \u76F4\u63A5\u7ED1\u5B9A</li></ol><h2 id="message-\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#message-\u6D88\u606F" aria-hidden="true">#</a> message \u6D88\u606F</h2><ol><li>\u53EF\u4EE5\u643A\u5E26 properties \u5C5E\u6027</li><li>==mandotary===true, \u53D1\u9001\u7AEF\u4F1A\u76D1\u542C\u5230\u8DEF\u7531\u4E0D\u5230\u7684\u6D88\u606F, \u5373 returnCallback, =false \u65F6, \u8DEF\u7531\u4E0D\u5230\u7684\u6D88\u606F\u4F1A\u88AB\u81EA\u52A8\u5220\u9664</li><li>\u53D1\u9001\u7AEF\u8981\u5904\u7406==confirmCallback== ==returnCallback==, \u914D\u7F6E\u91CC\u8FD9\u4E24\u9879\u5FC5\u987B\u8BBE\u4E3A true</li><li></li></ol><h2 id="\u6B7B\u4FE1\u961F\u5217-\u7279\u6B8A\u7684-exchange" tabindex="-1"><a class="header-anchor" href="#\u6B7B\u4FE1\u961F\u5217-\u7279\u6B8A\u7684-exchange" aria-hidden="true">#</a> \u6B7B\u4FE1\u961F\u5217(\u7279\u6B8A\u7684 exchange)</h2><ol><li>\u6D88\u606F\u88AB nack \u5E76\u4E14 requeue=false</li><li>ttl \u6D88\u606F\u8FC7\u671F</li><li>\u961F\u5217\u8FBE\u5230\u6700\u5927\u957F\u5EA6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u79C1\u4FE1: \u5C31\u662F\u666E\u901A\u7684exchange--<span class="token operator">&gt;</span>queue\u7ED1\u5B9A

\u4E1A\u52A1queue \u6DFB\u52A0\u989D\u5916\u7684\u53C2\u6570: x-dead-letter-exchange<span class="token operator">=</span>\u6B7B\u4FE1\u4EA4\u6362\u673A

\u8FD9\u6837\u4E1A\u52A1queue\u4E0A\u672A\u6D88\u8D39\u7684\u6D88\u606F\u5C31\u8DEF\u7531\u5230\u4E86\u79C1\u4FE1\u4EA4\u6362\u673A\u4E0A
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="\u6D88\u8D39\u8005" tabindex="-1"><a class="header-anchor" href="#\u6D88\u8D39\u8005" aria-hidden="true">#</a> \u6D88\u8D39\u8005</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test.queue&quot;</span><span class="token punctuation">,</span> durable <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> autoDelete <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test.exchange&quot;</span><span class="token punctuation">,</span> durable <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> autoDelete <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            key <span class="token operator">=</span> <span class="token string">&quot;test.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="\u76D1\u542C\u5668" tabindex="-1"><a class="header-anchor" href="#\u76D1\u542C\u5668" aria-hidden="true">#</a> \u76D1\u542C\u5668</h2><ol><li>simpleMessageListenerContainer</li></ol><p>\u4E3A\u961F\u5217\u6DFB\u52A0\u76D1\u542C\u4E8B\u4EF6</p><ol start="2"><li><p>messageListenerAdapter \u6D88\u606F\u9002\u914D\u5668</p><p>\u5904\u7406\u65B9\u6CD5 \u53EF\u4EE5\u4E3A\u6BCF\u4E2A\u961F\u5217\u6307\u5B9A\u4E0D\u540C\u7684\u5904\u7406\u65B9\u6CD5</p></li><li><p>messageConvert \u6D88\u606F\u8F6C\u5316\u5668 java \u5BF9\u8C61\u4E0E message \u5BF9\u8C61\u4E92\u8F6C</p></li></ol><h2 id="\u9AD8\u53EF\u7528" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u53EF\u7528" aria-hidden="true">#</a> \u9AD8\u53EF\u7528</h2><ol><li><p>\u955C\u50CF\u961F\u5217 : \u914D\u7F6E 1 \u4E2A Master, \u591A\u4E2A Slaver</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> <span class="token number">1</span>. master\u8282\u70B9 /var/lib/rabbitmq/.erlang.cookie \u62F7\u8D1D\u5230\u5404\u4E2A\u8282\u70B9
 <span class="token number">2</span>. \u542F\u52A8\u670D\u52A1 rabbitmq-server -detached
 <span class="token number">3</span>. \u5907\u7528\u8282\u70B9\u505C\u6B62\u670D\u52A1 rabbitmqctl stop_app
 <span class="token number">4</span>. \u5907\u7528\u8282\u70B9\u52A0\u5165\u5230\u4E3B\u8282\u70B9\u96C6\u7FA4\u4E2D rabbitmqctl join_cluster rabbit@xxxx<span class="token punctuation">(</span>hosts\u540D<span class="token punctuation">)</span>
 <span class="token number">5</span>. \u5907\u7528\u8282\u70B9\u542F\u52A8 rabbitmqctl start_app
 <span class="token number">6</span>. \u4EFB\u610F\u8282\u70B9\u8BBE\u7F6E\u96C6\u7FA4\u540D rabbitmqctl set_cluster_name xxxx
 <span class="token number">7</span>. \u67E5\u770B\u96C6\u7FA4\u72B6\u6001 rabbitmqctl cluster_status
 <span class="token number">8</span>. \u914D\u7F6E\u955C\u50CF\u961F\u5217: rabbitmqctl set_policy ha-all <span class="token string">&quot;^&quot;</span> <span class="token string">&#39;{&quot;ha-mode&quot;:&quot;all}&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>haproxy: \u8D1F\u8F7D\u5747\u8861</p></li></ol><h2 id="\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u63D2\u4EF6" aria-hidden="true">#</a> \u63D2\u4EF6</h2><ol><li>\u5EF6\u65F6\u63D2\u4EF6<code>rabbitmq_delayed_message_exchange</code><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> <span class="token number">1</span>. /usr/lib/rabbitmq/lib/rabbitmq_serverxxx/plugins
 <span class="token number">2</span>. rabbitmq-plugins <span class="token builtin class-name">enable</span> xxxx
 <span class="token number">3</span>. \u58F0\u660E\u4E00\u4E2Ax-delayed-type\u7C7B\u578B\u7684exchange
 <span class="token number">4</span>. \u53D1\u9001\u6D88\u606F\u65F6,\u6D88\u606Fheaders\u9700\u8981\u6307\u5B9Ax-delay<span class="token operator">=</span>xx\u6BEB\u79D2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol>`,22);function t(p,l){return e}var r=a(s,[["render",t]]);export{r as default};
