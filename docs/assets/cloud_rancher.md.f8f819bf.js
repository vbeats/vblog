import{o as s,c as n,d as a}from"./app.9f9f1749.js";const e='{"title":"Rancher ğŸ„","description":"","frontmatter":{},"headers":[{"level":2,"title":"Rancher ğŸ„","slug":"rancher-ğŸ„"},{"level":3,"title":"é«˜å¯ç”¨éƒ¨ç½²(k3s)","slug":"é«˜å¯ç”¨éƒ¨ç½²-k3s"}],"relativePath":"cloud/rancher.md","lastUpdated":1627891509266}',t={},p=a('<h2 id="rancher-ğŸ„"><a class="header-anchor" href="#rancher-ğŸ„" aria-hidden="true">#</a> Rancher ğŸ„</h2><p><a href="https://docs.rancher.cn/rancher2/" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a></p><h3 id="é«˜å¯ç”¨éƒ¨ç½²-k3s"><a class="header-anchor" href="#é«˜å¯ç”¨éƒ¨ç½²-k3s" aria-hidden="true">#</a> é«˜å¯ç”¨éƒ¨ç½²(k3s)</h3><table><thead><tr><th>ip</th><th>role</th></tr></thead><tbody><tr><td>192.168.100.80</td><td><a href="http://demo.com" target="_blank" rel="noopener noreferrer">demo.com</a>,æ•°æ®åº“,nginx</td></tr><tr><td>192.168.100.81</td><td>k3s server,rancher server</td></tr><tr><td>192.168.100.82</td><td>k3s server,rancher server</td></tr></tbody></table><blockquote><p>server èŠ‚ç‚¹å®‰è£… kubectl k3s helm å·¥å…·</p></blockquote><ol><li>k3s é›†ç¾¤</li></ol><p>k3s server èŠ‚ç‚¹ä¹ŸåŒæ—¶ä½œä¸º agent èŠ‚ç‚¹éƒ¨ç½² rancher</p><div class="language-bash"><pre><code><span class="token function">curl</span> -sfL https://get.k3s.io <span class="token operator">|</span> <span class="token function">sh</span> -s - server <span class="token punctuation">\\</span>\n  --datastore-endpoint<span class="token operator">=</span><span class="token string">&quot;mysql://username:password@tcp(hostname:3306)/database-name&quot;</span>\n\n\nk3s kubectl get nodes\n\n</code></pre></div><p>ä¿å­˜<code>kubeconfig</code>æ–‡ä»¶</p><div class="language-bash"><pre><code><span class="token function">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config\n\n\nkubectl get pods --all-namespaces\n\n<span class="token comment"># åˆ›å»ºrancherçš„namespace</span>\nkubectl create namespace cattle-system\n</code></pre></div><ol start="2"><li>è´Ÿè½½å‡è¡¡å™¨</li></ol><p><code>7å±‚ä»£ç†</code> tls åœ¨ rancher server/k3s é›†ç¾¤å†… ingress ç»ˆæ­¢</p><div class="language-nginx"><pre><code>    <span class="token directive"><span class="token keyword">upstream</span> rancher</span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">server</span> 192.168.100.81:80</span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">server</span> 192.168.100.82:80</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token directive"><span class="token keyword">map</span> <span class="token variable">$http_upgrade</span> <span class="token variable">$connection_upgrade</span></span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">default</span> Upgrade</span><span class="token punctuation">;</span>\n        &#39;&#39; <span class="token directive"><span class="token keyword">close</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">server_name</span> demo.com</span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">ssl_certificate</span> /root/demo.com.crt</span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /root/demo.com.key</span><span class="token punctuation">;</span>\n\n        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Port <span class="token variable">$server_port</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_pass</span> http://rancher</span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span>\n            <span class="token comment"># This allows the ability for the execute shell window to remain open for up to 15 minutes. Without this parameter, the default is 1 minute and will automatically close.</span>\n            <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">900s</span></span><span class="token punctuation">;</span>\n            <span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">server_name</span> demo.com</span><span class="token punctuation">;</span>\n        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n</code></pre></div><ol start="3"><li>helm å®‰è£… rancher server</li></ol><div class="language-bash"><pre><code>helm repo <span class="token function">add</span> rancher-stable https://releases.rancher.com/server-charts/stable\n\n<span class="token comment"># k8s secretæ·»åŠ sslè¯ä¹¦</span>\n\nkubectl -n cattle-system create secret tls tls-rancher-ingress <span class="token punctuation">\\</span>\n  --cert<span class="token operator">=</span>tls.pem <span class="token punctuation">\\</span>\n  --key<span class="token operator">=</span>tls.key\n\n<span class="token comment"># tlsè®¤è¯</span>\nhelm <span class="token function">install</span> rancher rancher-stable/rancher <span class="token punctuation">\\</span>\n  --namespace cattle-system <span class="token punctuation">\\</span>\n  --set <span class="token assign-left variable">hostname</span><span class="token operator">=</span>demo.com <span class="token punctuation">\\</span>\n  --set ingress.tls.source<span class="token operator">=</span>secret <span class="token punctuation">\\</span>\n  --set <span class="token assign-left variable">privateCA</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>\n  --set <span class="token assign-left variable">tls</span><span class="token operator">=</span>ingress <span class="token punctuation">\\</span>\n  --set <span class="token assign-left variable">replicas</span><span class="token operator">=</span><span class="token number">2</span>\n\n\n<span class="token comment"># tlséªŒè¯</span>\n\nopenssl s_client -connect demo.com:443 -servername demo.com <span class="token comment"># -CAfile ca.crt</span>\n\n<span class="token comment"># æŸ¥çœ‹å®‰è£…</span>\nkubectl -n cattle-system rollout status deploy/rancher\n\nkubectl -n cattle-system get deploy rancher\n\nkubectl get pods -n cattle-system\n\nkubectl describe pod xxxxx -n cattle-system\n\n</code></pre></div>',15);t.render=function(a,e,t,o,c,r){return s(),n("div",null,[p])};export default t;export{e as __pageData};
