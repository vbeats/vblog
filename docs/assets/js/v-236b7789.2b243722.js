"use strict";(self.webpackChunkvblog=self.webpackChunkvblog||[]).push([[642],{3492:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-236b7789",path:"/data/base/mysql.html",title:"MySQL ☢️",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"主从同步",slug:"主从同步",children:[]},{level:2,title:"MySQL 分区",slug:"mysql-分区",children:[]},{level:2,title:"PXC 同步",slug:"pxc-同步",children:[]},{level:2,title:"MyCat",slug:"mycat",children:[]},{level:2,title:"Percona",slug:"percona",children:[{level:3,title:"XtraBackup",slug:"xtrabackup",children:[]}]},{level:2,title:"ShardingSphere",slug:"shardingsphere",children:[]},{level:2,title:"配置",slug:"配置",children:[]},{level:2,title:"存储过程",slug:"存储过程",children:[{level:3,title:"存储函数",slug:"存储函数",children:[]},{level:3,title:"触发器",slug:"触发器",children:[]},{level:3,title:"event 事件处理",slug:"event-事件处理",children:[]},{level:3,title:"mysql 定时备份,邮件",slug:"mysql-定时备份-邮件",children:[]}]}],filePathRelative:"data/base/mysql.md",git:{updatedTime:1636365007e3,contributors:[{name:"bootvue",email:"bootvue@gmail.com",commits:1}]}}},7819:(n,s,a)=>{a.r(s),a.d(s,{default:()=>ts});var e=a(6252),l=a(5752);const t=(0,e._)("h1",{id:"mysql-☢️",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#mysql-☢️","aria-hidden":"true"},"#"),(0,e.Uk)(" MySQL ☢️")],-1),o=(0,e._)("h2",{id:"主从同步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#主从同步","aria-hidden":"true"},"#"),(0,e.Uk)(" 主从同步")],-1),_=(0,e._)("p",null,"主节点:",-1),p=(0,e._)("p",null,"配置文件:",-1),c=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e._)("span",{class:"token assign-left variable"},"server_id"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)("  唯一\nlog-bin"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("mysql-log\nexpire_logs_days "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"15"),(0,e.Uk)("\nbinlog-ignore-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("mysql  忽略同步\nbinlog-ignore-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("test\n\nbinlog-do-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx  要同步的数据库\n\n"),(0,e._)("span",{class:"token assign-left variable"},"binlog_format"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("STATEMENT  binlog格式\n\n"),(0,e._)("span",{class:"token assign-left variable"},"gtid_mode"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ON\n"),(0,e._)("span",{class:"token assign-left variable"},"enforce_gtid_consistency"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ON\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br")])],-1),r=(0,e._)("p",null,"statement :记录写操作 row: 记录每一行数据变化 mixed: 自动选择",-1),k=(0,e._)("blockquote",null,[(0,e._)("p",null,"创建一个用户, 赋予 replaction slave 权限")],-1),u=(0,e._)("blockquote",null,[(0,e._)("p",null,"CHANGE MASTER TO MASTER_DELAY = 1800；单位为秒 延迟从库同步时间")],-1),i=(0,e._)("blockquote",null,[(0,e._)("p",null,"show master status;")],-1),b=(0,e._)("p",null,"从节点:",-1),m=(0,e._)("p",null,"配置文件",-1),U=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("server-id"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"2"),(0,e.Uk)("\nrelay-log"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("mysql-relay\nlog-bin"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx\nbinlog-format"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ROW\n\nreplicate-do-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx  可以不指定\nreplicate-do-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx\n\nreplicate-ignore-db"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx\n\n"),(0,e._)("span",{class:"token assign-left variable"},"gtid_mode"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ON\n"),(0,e._)("span",{class:"token assign-left variable"},"enforce_gtid_consistency"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ON\n\nmysql"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(" CHANGE MASTER TO MASTER_HOST "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'10.*.*.36'"),(0,e.Uk)(", MASTER_USER "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'repl'"),(0,e.Uk)(", MASTER_PASSWORD "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'replpassword'"),(0,e.Uk)(", MASTER_PORT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"3306"),(0,e.Uk)(", MASTER_AUTO_POSITION "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)(", MASTER_RETRY_COUNT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"0"),(0,e.Uk)(", MASTER_HEARTBEAT_PERIOD "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"10000"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token comment"},"# master  用户密码 时  caching_sha2_password 策略的话  必须设置一个安全连接用户(要配置公钥私钥)"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token comment"},"# 或者"),(0,e.Uk)("\n\nCHANGE MASTER TO "),(0,e._)("span",{class:"token assign-left variable"},"master_host"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'192.168.49.80'"),(0,e.Uk)(", "),(0,e._)("span",{class:"token assign-left variable"},"master_port"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"30002"),(0,e.Uk)(", "),(0,e._)("span",{class:"token assign-left variable"},"master_auto_position"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("   "),(0,e._)("span",{class:"token comment"},"#需要开启gtid 并且不能与 master_log_file master_log_pos同时使用"),(0,e.Uk)("\nSTART SLAVE "),(0,e._)("span",{class:"token assign-left variable"},[(0,e._)("span",{class:"token environment constant"},"USER")]),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'mmss'"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'test'"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"DEFAULT_AUTH"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'mysql_native_password'"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\n\n"),(0,e._)("span",{class:"token comment"},"# 数据同步不一致"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token comment"},"# 清掉slave  导入数据后  继续开启同步"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br")])],-1),d=(0,e._)("blockquote",null,[(0,e._)("p",null,"stop slave;")],-1),g=(0,e._)("blockquote",null,[(0,e._)("p",null,"reset master; reset slave;")],-1),E=(0,e._)("blockquote",null,[(0,e._)("p",null,"show slave status;")],-1),h=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CHANGE MASTER TO option "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(", option"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(". "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(" channel_option "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\noption: "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    MASTER_BIND "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'interface_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_HOST "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'host_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_USER "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'user_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_PASSWORD "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'password'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_PORT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" port_num\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" PRIVILEGE_CHECKS_USER "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token string"},"'account'"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" NULL"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" REQUIRE_ROW_FORMAT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token operator"},"|"),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" REQUIRE_TABLE_PRIMARY_KEY_CHECK "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("STREAM "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" ON "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" OFF"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_CONNECT_RETRY "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" interval\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_RETRY_COUNT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" count\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_DELAY "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" interval\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_HEARTBEAT_PERIOD "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" interval\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_LOG_FILE "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'source_log_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_LOG_POS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" source_log_pos\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_AUTO_POSITION "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token operator"},"|"),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" RELAY_LOG_FILE "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'relay_log_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" RELAY_LOG_POS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" relay_log_pos\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_COMPRESSION_ALGORITHMS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'value'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_ZSTD_COMPRESSION_LEVEL "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" level\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token operator"},"|"),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CA "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'ca_file_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CAPATH "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'ca_directory_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CERT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'cert_file_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CRL "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'crl_file_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CRLPATH "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'crl_directory_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_KEY "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'key_file_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_CIPHER "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'cipher_list'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_SSL_VERIFY_SERVER_CERT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token operator"},"|"),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_TLS_VERSION "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'protocol_list'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_TLS_CIPHERSUITES "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'ciphersuite_list'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MASTER_PUBLIC_KEY_PATH "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'key_file_name'"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" GET_MASTER_PUBLIC_KEY "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token operator"},"|"),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" IGNORE_SERVER_IDS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("server_id_list"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\nchannel_option:\n    FOR CHANNEL channel\n\nserver_id_list:\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("server_id "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(", server_id"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(". "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"27"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"28"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"29"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"30"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"31"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"32"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"33"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"34"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"35"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"36"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"37"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"38"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"39"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"40"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"41"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"42"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"43"),(0,e._)("br")])],-1),y=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("START SLAVE "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("thread_types"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("until_option"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("connection_options"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("channel_option"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\nthread_types:\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("thread_type "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(", thread_type"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(". "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\nthread_type:\n    IO_THREAD "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SQL_THREAD\n\nuntil_option:\n    UNTIL "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("   "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("SQL_BEFORE_GTIDS "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SQL_AFTER_GTIDS"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" gtid_set\n          "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)("   MASTER_LOG_FILE "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'log_name'"),(0,e.Uk)(", MASTER_LOG_POS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" log_pos\n          "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)("   RELAY_LOG_FILE "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'log_name'"),(0,e.Uk)(", RELAY_LOG_POS "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" log_pos\n          "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)("   SQL_AFTER_MTS_GAPS  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\nconnection_options:\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token environment constant"},"USER"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'user_name'"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'user_pass'"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("DEFAULT_AUTH"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'plugin_name'"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("PLUGIN_DIR"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'plugin_dir'"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\n\nchannel_option:\n    FOR CHANNEL channel\n\ngtid_set:\n    uuid_set "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(", uuid_set"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"''"),(0,e.Uk)("\n\nuuid_set:\n    uuid:interval"),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(":interval"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\n\nuuid:\n    hhhhhhhh-hhhh-hhhh-hhhh-hhhhhhhhhhhh\n\nh:\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token number"},"0"),(0,e.Uk)("-9,A-F"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\ninterval:\n    n"),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("-n"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\n    "),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("n "),(0,e._)("span",{class:"token operator"},">="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"27"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"28"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"29"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"30"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"31"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"32"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"33"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"34"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"35"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"36"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"37"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"38"),(0,e._)("br")])],-1),v=(0,e._)("h2",{id:"mysql-分区",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#mysql-分区","aria-hidden":"true"},"#"),(0,e.Uk)(" MySQL 分区")],-1),T=(0,e._)("ol",null,[(0,e._)("li",null,"range: 给定一个连续区间的范围值进行分区")],-1),R=(0,e._)("div",{class:"language-sql ext-sql line-numbers-mode"},[(0,e._)("pre",{class:"language-sql"},[(0,e._)("code",null,[(0,e._)("span",{class:"token comment"},"-- 语法"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"create"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"table"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e._)("span",{class:"token keyword"},"table"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token comment"},"// 字段"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"ENGINE"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("MyISAM  "),(0,e._)("span",{class:"token keyword"},"DEFAULT"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"CHARSET"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8 "),(0,e._)("span",{class:"token keyword"},"AUTO_INCREMENT"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(" range "),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("分区字段"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("分区名称"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token keyword"},"Value"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("分区名称"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token keyword"},"Value"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"."),(0,e._)("span",{class:"token punctuation"},"."),(0,e._)("span",{class:"token punctuation"},"."),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("分区名称"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than maxvalue\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br")])],-1),S=(0,e._)("ol",{start:"2"},[(0,e._)("li",null,"list: 设置若干个固定值进行分区，如果某个字段的值在这个设置的值列表中就会被分配到该分区")],-1),A=(0,e._)("div",{class:"language-sql ext-sql line-numbers-mode"},[(0,e._)("pre",{class:"language-sql"},[(0,e._)("code",null,[(0,e._)("span",{class:"token comment"},"-- 语法"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"create"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"table"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e._)("span",{class:"token keyword"},"table"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token comment"},"// 字段"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"ENGINE"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("数据库引擎  "),(0,e._)("span",{class:"token keyword"},"DEFAULT"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"CHARSET"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8 "),(0,e._)("span",{class:"token keyword"},"AUTO_INCREMENT"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(" LIST "),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("分区字段或者基于该字段的返回的整数值的表达式"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("分区名称"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"IN"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("Value1，Value2"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(" Value3"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"."),(0,e._)("span",{class:"token punctuation"},"."),(0,e._)("span",{class:"token punctuation"},"."),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("分区名称"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"IN"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("Value4"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(" Value5"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br")])],-1),x=(0,e._)("ol",{start:"3"},[(0,e._)("li",null,"columns 分区: columns 分区分为 range columns 和 list columns 两种，支持整数(tinyint 到 bigint， 不支持 decimal 和 float)、日期(date、datetime)、字符串(char、varchar、binary、varbinary)三大数据类型")],-1),N=(0,e._)("div",{class:"language-sql ext-sql line-numbers-mode"},[(0,e._)("pre",{class:"language-sql"},[(0,e._)("code",null,[(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(" range "),(0,e._)("span",{class:"token keyword"},"columns"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("a"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(" b"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p01 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p02 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p03 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"20"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p04 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"35"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p05 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"10"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(" maxvalue"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n   "),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(" p06 "),(0,e._)("span",{class:"token keyword"},"values"),(0,e.Uk)(" less than "),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("maxvalue"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)(" maxvalue"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br")])],-1),O=(0,e._)("ol",{start:"4"},[(0,e._)("li",null,"hash 分区: 对分区键应用一个散列函数，以此确定数据应当放在 N 个分区中的哪个分区")],-1),L=(0,e._)("div",{class:"language-sql ext-sql line-numbers-mode"},[(0,e._)("pre",{class:"language-sql"},[(0,e._)("code",null,[(0,e._)("span",{class:"token comment"},"-- HASH"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"create"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"table"),(0,e.Uk)(),(0,e._)("span",{class:"token operator"},"<"),(0,e._)("span",{class:"token keyword"},"table"),(0,e._)("span",{class:"token operator"},">"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token comment"},"// 字段"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"ENGINE"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token keyword"},"innodb"),(0,e.Uk)("  "),(0,e._)("span",{class:"token keyword"},"DEFAULT"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"CHARSET"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8 "),(0,e._)("span",{class:"token keyword"},"AUTO_INCREMENT"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"PARTITION"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"BY"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"HASH"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("expr"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\nPARTITIONS "),(0,e._)("span",{class:"token operator"},"<"),(0,e.Uk)("num"),(0,e._)("span",{class:"token operator"},">"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),I=(0,e._)("ol",{start:"5"},[(0,e._)("li",null,"key 分区: key 分区不允许使用用于自定义的表达式，需要使用 mysql 服务器提供的 hash 函数，同时 hash 分区只支持整数分区，而 key 分区支持使用 blob or text 类型外的其他类型的列作为分区键")],-1),C=(0,e._)("div",{class:"language-sql ext-sql line-numbers-mode"},[(0,e._)("pre",{class:"language-sql"},[(0,e._)("code",null,[(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"key"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("expr"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(" partitions num"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token comment"},"-- 不指定默认首选主键作为分区键，在没有主键的情况下会选择非空唯一键作为分区键"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"key"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(" partitions num"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token comment"},"-- linear key"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token keyword"},"partition"),(0,e.Uk)(),(0,e._)("span",{class:"token keyword"},"by"),(0,e.Uk)(" linear "),(0,e._)("span",{class:"token keyword"},"key"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("expr"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br")])],-1),q=(0,e._)("h2",{id:"pxc-同步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#pxc-同步","aria-hidden":"true"},"#"),(0,e.Uk)(" PXC 同步")],-1),f=(0,e._)("p",null,"pecona 只支持 innodb 引擎 数据强一致性 实时同步数据",-1),w=(0,e._)("p",null,[(0,e.Uk)("pxc 集群启动时 要从最后一个退出的节点启动, 最后退出的节点会被标记为主节点, "),(0,e._)("code",null,"grastate.dat"),(0,e.Uk)(" 文件 safe_to_bootstrap=1 表示这个节点是最后退出的节点, 要作为主节点启动 文件位置在 mysql data 目录")],-1),M=(0,e._)("blockquote",null,[(0,e._)("p",null,"pxc 5.7.21 ,高版本有问题,待研究")],-1),D=(0,e._)("p",null,"主节点容器:",-1),H=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("docker run -d -p xxx:3306 "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"MYSQL_ROOT_PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("root "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"CLUSTER_NAME"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("master "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"XTRABACKUP_PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("root "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-v xxx:/var/lib/mysql --privileged "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n--name"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("node1 --net"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxxx pxc\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),P=(0,e._)("p",null,"从节点容器:",-1),F=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("docker run -d -p xxx:3306 -e "),(0,e._)("span",{class:"token assign-left variable"},"MYSQL_PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("root "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"CLUSTER_NAME"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("master "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"XTARBACKUP_PASSWORD"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("root "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-e "),(0,e._)("span",{class:"token assign-left variable"},"CLUSTER_JOIN"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("node1 "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n-v xxx:/var/lib/mysql --privileged "),(0,e._)("span",{class:"token punctuation"},"\\"),(0,e.Uk)("\n--name"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("node2 --net"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("xxx pxc\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),G=(0,e._)("p",null,"数据分片, 数据切分到不同的 pxc 集群上",-1),Y=(0,e._)("h2",{id:"mycat",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#mycat","aria-hidden":"true"},"#"),(0,e.Uk)(" MyCat")],-1),V=(0,e._)("blockquote",null,[(0,e._)("p",null,"听说 2.0 用 yml?")],-1),B=(0,e._)("p",null,[(0,e._)("code",null,"server.xml"),(0,e.Uk)(" 配置 mycat 虚拟用户与数据库, 可以配置多个")],-1),Q=(0,e._)("p",null,"pxc 只需要负载均衡 replication 需要读写分离",-1),W=(0,e._)("div",{class:"language-xml ext-xml line-numbers-mode"},[(0,e._)("pre",{class:"language-xml"},[(0,e._)("code",null,[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e._)("span",{class:"token namespace"},"mycat:"),(0,e.Uk)("server")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("user")]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"name"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("admin"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"defaultAccount"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("true"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("property")]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"name"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("password"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("admin"),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("property")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("property")]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"name"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("schemas"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("mycat"),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("property")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("user")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e._)("span",{class:"token namespace"},"mycat:"),(0,e.Uk)("server")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),K=(0,e._)("p",null,[(0,e._)("code",null,"schema.xml")],-1),X=(0,e._)("div",{class:"language-xml ext-xml line-numbers-mode"},[(0,e._)("pre",{class:"language-xml"},[(0,e._)("code",null,[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("dataHost")]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"name"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("mycat"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"maxCon"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("2000"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"minCon"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("100"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token attr-name"},"balance"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("0"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"writeType"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("1"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"dbType"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("mysql"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"dbDriver"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("native"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token attr-name"},"switchType"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("1"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"slaveThreshold"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("100"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("heartbeat")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("select 1"),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("heartbeat")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token comment"},"\x3c!--节点--\x3e"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"<"),(0,e.Uk)("writeHost")]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"host"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("xx"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"url"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("xxx:3306"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"user"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("root"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e._)("span",{class:"token attr-name"},"password"),(0,e._)("span",{class:"token attr-value"},[(0,e._)("span",{class:"token punctuation attr-equals"},"="),(0,e._)("span",{class:"token punctuation"},'"'),(0,e.Uk)("root"),(0,e._)("span",{class:"token punctuation"},'"')]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token comment"},"\x3c!--readHost balance需要为3--\x3e"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("writeHost")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token tag"},[(0,e._)("span",{class:"token punctuation"},"</"),(0,e.Uk)("dataHost")]),(0,e._)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br")])],-1),$=(0,e._)("p",null,[(0,e._)("code",null,"dataNode"),(0,e.Uk)(" 指定 mycat 使用的数据库")],-1),z=(0,e._)("p",null,[(0,e._)("code",null,"schema"),(0,e.Uk)(" 指定虚拟库, "),(0,e._)("code",null,"table"),(0,e.Uk)(" 指定切分的表")],-1),j=(0,e._)("p",null,[(0,e._)("code",null,"rule.xml")],-1),Z=(0,e._)("p",null,"分片规则",-1),J=(0,e._)("h2",{id:"percona",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#percona","aria-hidden":"true"},"#"),(0,e.Uk)(" Percona")],-1),nn=(0,e._)("h3",{id:"xtrabackup",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#xtrabackup","aria-hidden":"true"},"#"),(0,e.Uk)(" XtraBackup")],-1),sn=(0,e._)("h2",{id:"shardingsphere",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#shardingsphere","aria-hidden":"true"},"#"),(0,e.Uk)(" ShardingSphere")],-1),an=(0,e._)("ol",null,[(0,e._)("li",null,"数据分片")],-1),en=(0,e._)("blockquote",null,[(0,e._)("p",null,"配置对照 sharding-jdbc 看 , 官方文档写的和屎一样")],-1),ln=(0,e._)("blockquote",null,[(0,e._)("p",null,"sql 语句兼容性差,一些特殊字段 需要特别注意")],-1),tn=(0,e._)("div",{class:"language-yaml ext-yml line-numbers-mode"},[(0,e._)("pre",{class:"language-yaml"},[(0,e._)("code",null,[(0,e._)("span",{class:"token key atrule"},"schemaName"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" sharding_db\n\n"),(0,e._)("span",{class:"token key atrule"},"dataSources"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token key atrule"},"ds0"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"url"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" jdbc"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("mysql"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("//localhost"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("30002/ds\n    "),(0,e._)("span",{class:"token key atrule"},"username"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" root\n    "),(0,e._)("span",{class:"token key atrule"},"password"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" root\n    "),(0,e._)("span",{class:"token key atrule"},"connectionTimeoutMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"30000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"idleTimeoutMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"60000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"maxLifetimeMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1800000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"maxPoolSize"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"65"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token key atrule"},"ds1"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"url"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" jdbc"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("mysql"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("//localhost"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("30008/ds\n    "),(0,e._)("span",{class:"token key atrule"},"username"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" root\n    "),(0,e._)("span",{class:"token key atrule"},"password"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" root\n    "),(0,e._)("span",{class:"token key atrule"},"connectionTimeoutMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"30000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"idleTimeoutMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"60000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"maxLifetimeMilliseconds"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1800000"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"maxPoolSize"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"65"),(0,e.Uk)("\n\n"),(0,e._)("span",{class:"token key atrule"},"shardingRule"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token key atrule"},"tables"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"t_order"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"actualDataNodes"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" ds$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("0..1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)(".t_order$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("0..1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"databaseStrategy"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"inline"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token key atrule"},"shardingColumn"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" user_id\n          "),(0,e._)("span",{class:"token key atrule"},"algorithmExpression"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" ds$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("user_id % 2"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"tableStrategy"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"inline"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token key atrule"},"shardingColumn"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" order_id\n          "),(0,e._)("span",{class:"token key atrule"},"algorithmExpression"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" t_order$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("order_id % 2"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"keyGenerator"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token comment"},"# 可以不配置"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"type"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" SNOWFLAKE\n        "),(0,e._)("span",{class:"token key atrule"},"column"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" order_id\n    "),(0,e._)("span",{class:"token key atrule"},"t_order_item"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"actualDataNodes"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" ds$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("0..1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)(".t_order_item$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("0..1"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"databaseStrategy"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"inline"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token key atrule"},"shardingColumn"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" user_id\n          "),(0,e._)("span",{class:"token key atrule"},"algorithmExpression"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" ds$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("user_id % 2"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"tableStrategy"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"inline"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token key atrule"},"shardingColumn"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" order_id\n          "),(0,e._)("span",{class:"token key atrule"},"algorithmExpression"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" t_order_item$"),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("order_id % 2"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token key atrule"},"keyGenerator"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token key atrule"},"type"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" SNOWFLAKE\n        "),(0,e._)("span",{class:"token key atrule"},"column"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" order_item_id\n  "),(0,e._)("span",{class:"token key atrule"},"bindingTables"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"-"),(0,e.Uk)(" t_order"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("t_order_item\n  "),(0,e._)("span",{class:"token key atrule"},"defaultDataSourceName"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(" ds0 "),(0,e._)("span",{class:"token comment"},"#  默认数据源 不分片  只能指定一个  没有指定其它规则的表都写到这一个节点"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token key atrule"},"broadcastTables"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token comment"},"#  广播表    所有节点都会同步写入   查询的时候从一个节点查"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"-"),(0,e.Uk)(" user\n  "),(0,e._)("span",{class:"token key atrule"},"defaultTableStrategy"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token key atrule"},"none"),(0,e._)("span",{class:"token punctuation"},":"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"27"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"28"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"29"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"30"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"31"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"32"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"33"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"34"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"35"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"36"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"37"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"38"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"39"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"40"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"41"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"42"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"43"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"44"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"45"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"46"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"47"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"48"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"49"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"50"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"51"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"52"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"53"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"54"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"55"),(0,e._)("br")])],-1),on=(0,e._)("p",null,[(0,e._)("img",{src:l,alt:"示例"})],-1),_n=(0,e._)("h2",{id:"配置",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#配置","aria-hidden":"true"},"#"),(0,e.Uk)(" 配置")],-1),pn=(0,e._)("blockquote",null,[(0,e._)("p",null,"查看 mysql 文档, 区分 命令行配置 系统变量 配置文件...., 可配置项不完全相同")],-1),cn=(0,e._)("blockquote",null,[(0,e._)("p",null,"验证配置: mysqld --validate-config")],-1),rn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("mysqld"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\npid-file\t"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" /var/run/mysqld/mysqld.pid\nsocket\t\t"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" /var/run/mysqld/mysqld.sock\ndatadir\t\t"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" /var/lib/mysql\n"),(0,e._)("span",{class:"token comment"},"#log-error\t= /var/log/mysql/error.log"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token comment"},"# By default we only accept connections from localhost"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token comment"},"#bind-address\t= 127.0.0.1"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token comment"},"# Disabling symbolic-links is recommended to prevent assorted security risks"),(0,e.Uk)("\nsymbolic-links"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token assign-left variable"},"character_set_server"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8mb4\n"),(0,e._)("span",{class:"token assign-left variable"},"collation_server"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8mb4_0900_ai_ci\n"),(0,e._)("span",{class:"token assign-left variable"},"max_connections"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"1000"),(0,e.Uk)("\ndefault-time-zone"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},"'+8:00'"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token assign-left variable"},"slow_query_log"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("ON\n"),(0,e._)("span",{class:"token assign-left variable"},"long_query_time"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token number"},"10"),(0,e.Uk)("  "),(0,e._)("span",{class:"token comment"},"# 默认10s"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token assign-left variable"},"max_allowed_packet"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("256M\n"),(0,e._)("span",{class:"token assign-left variable"},"innodb_log_file_size"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("2GB\n\n"),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("client"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\ndefault-character-set"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("utf8mb4\n\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br")])],-1),kn=(0,e._)("h2",{id:"存储过程",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#存储过程","aria-hidden":"true"},"#"),(0,e.Uk)(" 存储过程")],-1),un=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CREATE "),(0,e._)("span",{class:"token assign-left variable"},"DEFINER"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token variable"},[(0,e._)("span",{class:"token variable"},"`"),(0,e.Uk)("root"),(0,e._)("span",{class:"token variable"},"`")]),(0,e.Uk)("@"),(0,e._)("span",{class:"token variable"},[(0,e._)("span",{class:"token variable"},"`"),(0,e.Uk)("localhost"),(0,e._)("span",{class:"token variable"},"`")]),(0,e.Uk)(" PROCEDURE "),(0,e._)("span",{class:"token variable"},[(0,e._)("span",{class:"token variable"},"`"),(0,e._)("span",{class:"token builtin class-name"},"test"),(0,e._)("span",{class:"token variable"},"`")]),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\nBEGIN\n\tSELECT * from student"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\nEND\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br")])],-1),bn=(0,e._)("p",null,"调用:",-1),mn=(0,e._)("blockquote",null,[(0,e._)("p",null,"call test();")],-1),Un=(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("p",null,"变量"),(0,e._)("blockquote",null,[(0,e._)("p",null,[(0,e.Uk)("DECLARE x, y INT DEFAULT 0; "),(0,e._)("code",null,"声明"),(0,e.Uk)(" SET x=10; "),(0,e._)("code",null,"赋值"),(0,e.Uk)(" select ... INTO y from....; "),(0,e._)("code",null,"赋值")])])]),(0,e._)("li",null,[(0,e._)("p",null,"参数"),(0,e._)("blockquote",null,[(0,e._)("p",null,[(0,e._)("code",null,"IN OUT INOUT")])])])],-1),dn=(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("code",null,"IN")])],-1),gn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CREATE PROCEDURE xxx"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("IN zz VARCHAR"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"255"),(0,e._)("span",{class:"token punctuation"},"))"),(0,e.Uk)("\n调用的时候: call xxx"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token string"},'"测试"'),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br")])],-1),En=(0,e._)("ol",{start:"2"},[(0,e._)("li",null,[(0,e._)("code",null,"OUT")])],-1),hn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CREATE PROCEDURE xxx"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n IN x VARCHAR"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"25"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(",\n OUT y INT"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n 调用: call xxx"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token string"},'"测试"'),(0,e.Uk)(",@oo"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n "),(0,e._)("span",{class:"token keyword"},"select"),(0,e.Uk)(" @oo"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("  //@"),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(". 局部变量\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br")])],-1),yn=(0,e._)("ul",null,[(0,e._)("li",null,"流程控制")],-1),vn=(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("code",null,"IF")])],-1),Tn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("IF expression THEN\n   statements"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nEND IF"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br")])],-1),Rn=(0,e._)("ol",{start:"2"},[(0,e._)("li",null,[(0,e._)("code",null,"CASE")])],-1),Sn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CASE  case_expression\n   WHEN when_expression_1 THEN commands\n   WHEN when_expression_2 THEN commands\n   "),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\n   ELSE commands\nEND CASE"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),An=(0,e._)("ol",{start:"3"},[(0,e._)("li",null,[(0,e._)("code",null,"while")])],-1),xn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,"WHILE expression DO\n   statements\nEND WHILE\n")]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br")])],-1),Nn=(0,e._)("ol",{start:"4"},[(0,e._)("li",null,[(0,e._)("code",null,"repeat")])],-1),On=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("REPEAT\n statements"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nUNTIL expression\nEND REPEAT\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br")])],-1),Ln=(0,e._)("ol",{start:"5"},[(0,e._)("li",null,[(0,e._)("code",null,"loop"),(0,e._)("blockquote",null,[(0,e._)("p",null,"leave :跳出循环 iterate: 继续下一次循环,类似 continue")])])],-1),In=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("xxx: LOOP\n"),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\nend xxx"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br")])],-1),Cn=(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("code",null,"游标"),(0,e._)("blockquote",null,[(0,e._)("p",null,"声明: DECLARE cursor_name CURSOR FOR SELECT_statement; OPEN 语句初始化游标的结果集: open cursor_name; FETCH 检索游标下一行: FETCH cursor_name INTO variables; DECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = 1; //游标结束 完整声明:")])])],-1),qn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("DECLARE finished INTEGER DEFAULT "),(0,e._)("span",{class:"token number"},"0"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nDECLARE email varchar"),(0,e._)("span",{class:"token punctuation"},"("),(0,e._)("span",{class:"token number"},"255"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(" DEFAULT "),(0,e._)("span",{class:"token string"},'""'),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\nDEClARE email_cursor CURSOR FOR SELECT email FROM employees"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br")])],-1),fn=(0,e._)("p",null,"遍历游标:",-1),wn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("OPEN email_cursor"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nget_email: LOOP\nFETCH email_cursor INTO v_email"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nIF finished "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1"),(0,e.Uk)(" THEN\nLEAVE get_email"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nEND IF"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nSET email_list "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(" CONCAT"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("v_email,"),(0,e._)("span",{class:"token string"},'";"'),(0,e.Uk)(",email_list"),(0,e._)("span",{class:"token punctuation"},")"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\nEND LOOP get_email"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\nCLOSE email_cursor"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br")])],-1),Mn=(0,e._)("ul",null,[(0,e._)("li",null,"异常处理")],-1),Dn=(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("code",null,"signal/resignal"),(0,e._)("blockquote",null,[(0,e._)("p",null,"相当于直接抛出 sql 异常")])])],-1),Hn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("IF"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("C "),(0,e._)("span",{class:"token operator"},"!="),(0,e.Uk)(),(0,e._)("span",{class:"token number"},"1"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)(" THEN\n SIGNAL SQLSTATE "),(0,e._)("span",{class:"token string"},"'45000'"),(0,e.Uk)(" //只能使用sqlstate的值\n SET MESSAGE_TEXT "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token string"},"'......'"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)(" //只能是MESSAGE_TEXT，MYSQL_ERRORNO，CURSOR_NAME\n END IF"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br")])],-1),Pn=(0,e._)("ol",{start:"2"},[(0,e._)("li",null,[(0,e._)("code",null,"handler")])],-1),Fn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("DECLARE handler_action HANDLER\n    FOR condition_value "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)(", condition_value"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\n    statement\n\nhandler_action:\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" CONTINUE\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" EXIT\n\ncondition_value:\n    mysql_error_code\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SQLSTATE "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("VALUE"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(" sqlstate_value\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" condition_name\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SQLWARNING\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" NOT FOUND\n    "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SQLEXCEPTION\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br")])],-1),Gn=(0,e._)("h3",{id:"存储函数",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#存储函数","aria-hidden":"true"},"#"),(0,e.Uk)(" 存储函数")],-1),Yn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CREATE FUNCTION function_name"),(0,e._)("span",{class:"token punctuation"},"("),(0,e.Uk)("param1,param2,…"),(0,e._)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    RETURNS datatype\n   "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("NOT"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(" DETERMINISTIC\n statements\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br")])],-1),Vn=(0,e._)("blockquote",null,[(0,e._)("p",null,"必须有 returns, 仅返回一个值")],-1),Bn=(0,e._)("h3",{id:"触发器",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#触发器","aria-hidden":"true"},"#"),(0,e.Uk)(" 触发器")],-1),Qn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,"CREATE TRIGGER trigger_name trigger_time trigger_event ON tb_name FOR EACH ROW trigger_stmt\ntrigger_name：触发器的名称\ntirgger_time：触发时机，为BEFORE或者AFTER\ntrigger_event：触发事件，为INSERT、DELETE或者UPDATE\ntb_name：表示建立触发器的表明，就是在哪张表上建立触发器\ntrigger_stmt：触发器的程序体，可以是一条SQL语句或者是用BEGIN和END包含的多条语句\n所以可以说MySQL创建以下六种触发器：\nBEFORE INSERT,BEFORE DELETE,BEFORE UPDATE\nAFTER INSERT,AFTER DELETE,AFTER UPDATE\n")]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br")])],-1),Wn=(0,e._)("h3",{id:"event-事件处理",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#event-事件处理","aria-hidden":"true"},"#"),(0,e.Uk)(" event 事件处理")],-1),Kn=(0,e._)("blockquote",null,[(0,e._)("p",null,"mysql 默认关闭了事件执行, 配合文件里记得开启 event_scheduler = 1 #或者 ON")],-1),Xn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e.Uk)("CREATE\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("DEFINER "),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" user "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" CURRENT_USER "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    EVENT\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("IF NOT EXISTS"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    event_name\n    ON SCHEDULE schedule\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("ON COMPLETION "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("NOT"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(" PRESERVE"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("ENABLE "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" DISABLE "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" DISABLE ON SLAVE"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("COMMENT "),(0,e._)("span",{class:"token string"},"'comment'"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    DO event_body"),(0,e._)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n\nschedule:\n    AT timestamp "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("+ INTERVAL interval"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)(".\n  "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" EVERY interval\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("STARTS timestamp "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("+ INTERVAL interval"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)("."),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("ENDS timestamp "),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("+ INTERVAL interval"),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},".."),(0,e.Uk)("."),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n\ninterval:\n    quantity "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("YEAR "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" QUARTER "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MONTH "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" DAY "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" HOUR "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MINUTE "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)("\n              WEEK "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" SECOND "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" YEAR_MONTH "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" DAY_HOUR "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" DAY_MINUTE "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)("\n              DAY_SECOND "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" HOUR_MINUTE "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" HOUR_SECOND "),(0,e._)("span",{class:"token operator"},"|"),(0,e.Uk)(" MINUTE_SECOND"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br")])],-1),$n=(0,e._)("h3",{id:"mysql-定时备份-邮件",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#mysql-定时备份-邮件","aria-hidden":"true"},"#"),(0,e.Uk)(" mysql 定时备份,邮件")],-1),zn=(0,e._)("blockquote",null,[(0,e._)("p",null,"mysqldump -uroot -pxxx -RE --databases xxx > dd.sql -RE: 导出存储过程和 event")],-1),jn=(0,e._)("p",null,"邮件发送配置: sendmail: 要启动服务",-1),Zn=(0,e._)("p",null,"/etc/mail.rc",-1),Jn=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"from"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("yourname@your-domain.com\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"smtp"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("mail.your-domain.com\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(" smtp-auth-user"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("yourname\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(" smtp-auth-password"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("yourpasswd\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(" smtp-auth"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("login\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br")])],-1),ns=(0,e._)("p",null,"mutt /etc/Muttrc:",-1),ss=(0,e._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e._)("pre",{class:"language-bash"},[(0,e._)("code",null,[(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"use_from"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("yes\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"realname"),(0,e._)("span",{class:"token operator"},"="),(0,e._)("span",{class:"token string"},'"data"'),(0,e.Uk)("\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"from"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("data@darkstone.cc\n"),(0,e._)("span",{class:"token builtin class-name"},"set"),(0,e.Uk)(),(0,e._)("span",{class:"token assign-left variable"},"envelope_from"),(0,e._)("span",{class:"token operator"},"="),(0,e.Uk)("yes\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br")])],-1),as=(0,e._)("blockquote",null,[(0,e._)("p",null,'mutt xxx@cc.com -s "标题" -a 附件')],-1),es=(0,e._)("blockquote",null,[(0,e._)("p",null,'有问题: mail 命令发送小文件可以, 大文件不能当附件. mutt 没成功过 echo "正文内容"|mail -s "标题" -a 附件 xx@cc.com')],-1),ls={},ts=(0,a(3744).Z)(ls,[["render",function(n,s){return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,o,_,p,c,r,k,u,i,b,m,U,d,g,E,h,y,v,T,R,S,A,x,N,O,L,I,C,q,f,w,M,D,H,P,F,G,Y,V,B,Q,W,K,X,$,z,j,Z,J,nn,sn,an,en,ln,tn,on,_n,pn,cn,rn,kn,un,bn,mn,Un,dn,gn,En,hn,yn,vn,Tn,Rn,Sn,An,xn,Nn,On,Ln,In,Cn,qn,fn,wn,Mn,Dn,Hn,Pn,Fn,Gn,Yn,Vn,Bn,Qn,Wn,Kn,Xn,$n,zn,jn,Zn,Jn,ns,ss,as,es],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{for(const[a,e]of s)n[a]=e;return n}},5752:(n,s,a)=>{n.exports=a.p+"assets/img/sproxy.0633d8c0.png"}}]);