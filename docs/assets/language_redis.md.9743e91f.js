import{o as n,c as s,a,b as e}from"./app.11603a1f.js";const t='{"title":"Redis","description":"","frontmatter":{},"headers":[{"level":2,"title":"Redis","slug":"redis-1"},{"level":3,"title":"缓存策略:","slug":"缓存策略"},{"level":3,"title":"redis-cluster","slug":"redis-cluster"},{"level":3,"title":"springboot 查询缓存","slug":"springboot-查询缓存"}],"relativePath":"language/redis.md","lastUpdated":1627216648963}',l={},o=a("h1",{id:"redis"},[a("a",{class:"header-anchor",href:"#redis","aria-hidden":"true"},"#"),e(" Redis")],-1),c=a("p",null,"嘿嘿嘿",-1),i=a("h2",{id:"redis-1"},[a("a",{class:"header-anchor",href:"#redis-1","aria-hidden":"true"},"#"),e(" Redis")],-1),u=a("div",{class:"language-bash"},[a("pre",null,[a("code",null,[e("redis-cli "),a("span",{class:"token operator"},">"),e(" info clients\nredis-cli "),a("span",{class:"token operator"},">"),e(" client list\nredis-cli "),a("span",{class:"token operator"},">"),e(" config get "),a("span",{class:"token function"},"timeout"),e("\n\n"),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token string"},'"timeout"'),e("\n"),a("span",{class:"token number"},"2"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token string"},'"0"'),e(),a("span",{class:"token comment"},"#0表示不开启空闲清除"),e("\n设置空闲清理时间\n\nredis-cli "),a("span",{class:"token operator"},">"),e(" config "),a("span",{class:"token builtin class-name"},"set"),e(),a("span",{class:"token function"},"timeout"),e(),a("span",{class:"token number"},"600"),e("\n")])])],-1),p=a("h3",{id:"缓存策略"},[a("a",{class:"header-anchor",href:"#缓存策略","aria-hidden":"true"},"#"),e(" 缓存策略:")],-1),r=a("p",null,[e("开启内存限制 "),a("code",null,"maxmemory bytes")],-1),k=a("div",{class:"language-bash"},[a("pre",null,[a("code",null,[e("noeviction: 不删除策略, 达到最大内存限制时, 如果需要更多内存, 直接返回错误信息。\nallkeys-lru: 所有key通用"),a("span",{class:"token punctuation"},";"),e(" 优先删除最近最少使用"),a("span",{class:"token punctuation"},"("),e("less recently used ,LRU"),a("span",{class:"token punctuation"},")"),e(" 的 key\nvolatile-lru: 只限于设置了 expire 的部分"),a("span",{class:"token punctuation"},";"),e(" 优先删除最近最少使用"),a("span",{class:"token punctuation"},"("),e("less recently used ,LRU"),a("span",{class:"token punctuation"},")"),e(" 的 key\nallkeys-random: 所有key通用"),a("span",{class:"token punctuation"},";"),e(" 随机删除一部分 key\nvolatile-random: 只限于设置了 expire 的部分"),a("span",{class:"token punctuation"},";"),e(" 随机删除一部分 key\nvolatile-ttl: 只限于设置了 expire 的部分"),a("span",{class:"token punctuation"},";"),e(" 优先删除剩余时间"),a("span",{class:"token punctuation"},"("),e("time to live,TTL"),a("span",{class:"token punctuation"},")"),e(" 短的key\n")])])],-1),d=a("ol",null,[a("li",null,"RDB: 手动/自动触发,dump 快照方式, save m n: 表示 m 秒之内数据集存在 n 次修改时，自动触发 bgsave"),a("li",null,"AOF: 独立 log 日志记录写操作 always:每次写操作都记录 everysec: 1 秒同步记录一次 no:不同步记录"),a("li",null,"redis 密码配置 requirepass xxx"),a("li",null,"主从配置 replicaof(slaveof) ip port"),a("li",null,"master 有密码的话 masterauth xxx")],-1),m=a("blockquote",null,[a("p",null,"哨兵配置 sentinel.conf")],-1),h=a("ol",null,[a("li",null,"sentinel monitor master_name ip port 票数(1,2…) ------\x3e监听 master, 集群下保证 master_name 一致, 最好每个节点都放一个 sentinel.conf"),a("li",null,"启动哨兵 redis-sentinel /…sentinel.conf"),a("li",null,"有 redis-server 挂掉, 哨兵会重新选择 master")],-1),g=a("p",null,[a("img",{src:"/assets/redis.cb5e764f.png",alt:"redis"})],-1),y=a("h3",{id:"redis-cluster"},[a("a",{class:"header-anchor",href:"#redis-cluster","aria-hidden":"true"},"#"),e(" redis-cluster")],-1),b=a("blockquote",null,[a("p",null,"集群吊炸天")],-1),f=a("p",null,"spring boot 配置哨兵:",-1),v=a("div",{class:"language-yml"},[a("pre",null,[a("code",null,[a("span",{class:"token key atrule"},"spring"),a("span",{class:"token punctuation"},":"),e("\n  "),a("span",{class:"token key atrule"},"redis"),a("span",{class:"token punctuation"},":"),e("\n    "),a("span",{class:"token key atrule"},"sentinel"),a("span",{class:"token punctuation"},":"),e("\n      "),a("span",{class:"token key atrule"},"master"),a("span",{class:"token punctuation"},":"),e(" testmaster\n      "),a("span",{class:"token key atrule"},"nodes"),a("span",{class:"token punctuation"},":"),e(" 192.168.142.88"),a("span",{class:"token punctuation"},":"),a("span",{class:"token number"},"26379"),a("span",{class:"token punctuation"},","),e("192.168.142.89"),a("span",{class:"token punctuation"},":"),a("span",{class:"token number"},"26379"),a("span",{class:"token punctuation"},","),e("192.168.142.90"),a("span",{class:"token punctuation"},":"),a("span",{class:"token number"},"26379"),e("\n")])])],-1),x=a("h3",{id:"springboot-查询缓存"},[a("a",{class:"header-anchor",href:"#springboot-查询缓存","aria-hidden":"true"},"#"),e(" springboot 查询缓存")],-1),R=a("ol",null,[a("li",null,"springboot 启动类不要忘记@Enablecaching 注解"),a("li",null,"Controller 查询操作, @Cacheable(cacheNames=‘’,key=‘’), 查询方法返回的对象要能序列化"),a("li",null,"更新或者删除缓存@CachePut(cacheNames=‘’,key=‘’),更新缓存数据 @CacheEvict(cacheNames = “”),清除缓存"),a("li",null,"key 如果不填,默认为方法的参数. 类上配置@cacheconfig(cacheNames=‘’),方法上可以省略 cachename 配置"),a("li",null,"key 可以对应方法的参数, condition 缓存的条件, unless 不缓存的条件(#result 代表返回值)")],-1),C=a("div",{class:"language-java"},[a("pre",null,[a("code",null,[a("span",{class:"token annotation punctuation"},"@GetMapping"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"/list"'),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token annotation punctuation"},"@Cacheable"),a("span",{class:"token punctuation"},"("),e("cacheNames"),a("span",{class:"token operator"},"="),a("span",{class:"token string"},'"product"'),a("span",{class:"token punctuation"},","),e("key"),a("span",{class:"token operator"},"="),a("span",{class:"token string"},'"#id"'),a("span",{class:"token punctuation"},","),e("condition"),a("span",{class:"token operator"},"="),a("span",{class:"token string"},'"#id.length>0"'),a("span",{class:"token punctuation"},","),e("unless"),a("span",{class:"token operator"},"="),a("span",{class:"token string"},'"#result.getCode()!=200"'),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token keyword"},"public"),e(),a("span",{class:"token class-name"},"Result"),e(),a("span",{class:"token function"},"list"),a("span",{class:"token punctuation"},"("),a("span",{class:"token annotation punctuation"},"@RequestParam"),a("span",{class:"token punctuation"},"("),e('"id'),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"int"),e(" id"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(" xxxxx"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")])])],-1);l.render=function(a,e,t,l,N,q){return n(),s("div",null,[o,c,i,u,p,r,k,d,m,h,g,y,b,f,v,x,R,C])};export default l;export{t as __pageData};
